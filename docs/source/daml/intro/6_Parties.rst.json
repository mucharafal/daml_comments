[
  {
    "id" : "6ba096fd-62b0-40d5-8401-a84f831cbbeb",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "3a0b8f75-0311-4142-86ff-6b7818059c6a",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n6 Parties and authority\r\n```",
        "createdAt" : "2019-06-17T14:05:53Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority"
  },
  {
    "id" : "2c31b9ae-9277-4d04-b539-db56ed16aa4c",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "14cd98d7-ac81-418e-b6e8-e2844f1d2c9a",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nDAML is designed for distributed applications involving mutually distrusting parties. In a well-constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices.\r\n\r\nIn this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to:\r\n```",
        "createdAt" : "2019-06-17T14:06:19Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to"
  },
  {
    "id" : "12cec01c-6755-46ad-b464-64f31c654a63",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "210fb7da-90a3-49d3-b103-5e43375938df",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nPreventing IOU revocation\r\n```",
        "createdAt" : "2019-06-17T14:06:30Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation"
  },
  {
    "id" : "9ace1ee2-8f8c-4940-b18c-acd1b5fcc805",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "c712d551-2d6f-47d3-a713-2376cfc91c85",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nThe ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: the contract is only signed by the ``issuer``, and the signatories are the parties with the power to create and archive contracts.\r\n\r\nThis means, if Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record of her actions, but would have to resort to off-ledger means to get his money back.\r\n```",
        "createdAt" : "2019-06-17T14:07:15Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "d3ae94a4-c2cf-49fe-86ab-0743a1edf0a4",
        "parentId" : "c712d551-2d6f-47d3-a713-2376cfc91c85",
        "author" : {
          "login" : "bame-da",
          "name" : "Bernhard Elsner",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/40762178?u=28b5edbfe9271d5db3fcfa3b80d30f93cce4321f&v=4"
        },
        "body" : "I would capitalize after colon if what comes after is a complete sentence. Do you always lower-case after colon?",
        "createdAt" : "2019-06-18T07:33:07Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bame-da",
          "name" : "Bernhard Elsner",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/40762178?u=28b5edbfe9271d5db3fcfa3b80d30f93cce4321f&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : 18,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back."
  },
  {
    "id" : "804055d9-38e2-4483-813e-0e62c0c3443f",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "2b12618c-8704-4384-871d-8acf72528bf1",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nNote also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel`` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\r\n```",
        "createdAt" : "2019-06-17T14:08:50Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates."
  },
  {
    "id" : "3b05bba3-0d35-4398-8299-2cf255d33244",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "a34edaa4-d306-407f-8185-bf054f81f000",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nJointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an IOU:\r\n```",
        "createdAt" : "2019-06-17T14:31:11Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:"
  },
  {
    "id" : "6345caf0-abf7-41bc-aa36-0d08a1564d4c",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "e3a61de3-e3b7-4f55-aa7a-f1ca97b55312",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nUp to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``.\r\n\r\nThe above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\r\n```",
        "createdAt" : "2019-06-17T14:31:40Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments."
  },
  {
    "id" : "4848e4bc-1daf-49af-9ecd-0434f353fadd",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "6a722349-3049-46cb-8fe5-bd1cb4245b0d",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nThe above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. \r\n\r\nHere it is in action:\r\n```",
        "createdAt" : "2019-06-17T14:32:45Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:"
  },
  {
    "id" : "4b2f3471-3746-4218-a738-6c27d3f0abfd",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "a8bb0d5c-4937-4bd0-8fac-0fd83fd7834f",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n- The required authorizers of an **exercise action** are the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\r\n```",
        "createdAt" : "2019-06-17T14:33:31Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers."
  },
  {
    "id" : "486bf9bf-ab5d-4bed-84f4-4f885afd2ee9",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "60d50c54-5ec3-47f4-9a11-8d25d3c3b321",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n- The required authorizers of a **create action** are the signatories of the contract.\r\n```",
        "createdAt" : "2019-06-17T14:33:47Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract."
  },
  {
    "id" : "799fc9a6-8fca-42cf-aabf-8eef3ca81c43",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "3e94246a-55f2-4c0a-8e07-c3abbcb75625",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n- The required authorizers of a **fetch action** (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\r\n```",
        "createdAt" : "2019-06-17T14:34:00Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later."
  },
  {
    "id" : "40d8909b-3d9f-46dd-bedc-31c29aabadcb",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "6e18daae-d7c0-499d-b826-356e191e400c",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "This could be more explicitly contrasted with the above: eg, spell out that the above are who MUST authorize, otherwise the action will fail, and this list is who HAS authorized a transaction or an action.",
        "createdAt" : "2019-06-17T14:35:15Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:"
  },
  {
    "id" : "05db2468-dfa1-4690-a317-d6030ce78c91",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "247dff8b-cb86-4ddf-b3e5-0e6207a9d9d5",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "Could you put this up front - explain the rule, and then explain who those authorizers are?",
        "createdAt" : "2019-06-17T14:35:39Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction."
  },
  {
    "id" : "b94eb4d1-67a4-41d4-bb8c-297ffc18f697",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "62a77f6d-0894-4df1-9178-41ee994f71af",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "Maybe a sub-heading here, \"Who must authorize a transaction\"",
        "createdAt" : "2019-06-17T14:36:21Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : 131,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences."
  },
  {
    "id" : "af376404-6124-4dfd-8554-8fd3bedf99cb",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "0fa0d91e-68ed-40fc-b64e-646740436ee3",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "Maybe a sub-heading here, along the lines of \"An example of authorization\"",
        "createdAt" : "2019-06-17T14:36:52Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:"
  },
  {
    "id" : "c0ae7dc6-621c-478d-ac9a-5b56982ce4d9",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "a69e82c5-77f4-4a0b-b285-a7879ae4cfd7",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob as ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer.\r\n```",
        "createdAt" : "2019-06-17T14:37:15Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:\n+\n+- Bob submits the transaction so he's the authorizer on the root transaction.\n+- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob and ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer."
  },
  {
    "id" : "9bbdd7b5-2fae-4c2e-a8d3-2008fefa63f5",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "a2d9d2e0-a5af-4b5b-902b-0b2250cf0dc2",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\n- The consequences contain a single action, which is a ``Mutual_Exercise`` with Charlie as ``newOwner`` on an ``Iou`` with ``issuer`` alice and ``owner`` Bob. The required authorizers of the action are the ``owner``, Bob, and the ``newOwner``, Charlie, which matches the parent's authorizers.\r\n```",
        "createdAt" : "2019-06-17T14:38:03Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:\n+\n+- Bob submits the transaction so he's the authorizer on the root transaction.\n+- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob and ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer.\n+- The consequences of the ``Send_Iou`` action are authorized by its actors, Bob, as well as signatories of the contract on which the action was taken. That's Charlie in this case, so the consequences are  authorized by both Bob and Charlie.\n+- The consequences contain a single action, which is a ``Mutual_Exercise`` with Charlie as ``newOwner`` on an ``Iou`` with ``issuer`` alice and ``owner`` Bob. The required authorizers of the action are the ``owner``, Bob, and the ``newOwner``, Charlie, which mathes the parent's authorizers."
  },
  {
    "id" : "5f819489-763a-4cba-b0e5-34fb9a4884ef",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "b1dbb100-eec8-41f6-9cc5-ea27b46d66ae",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nYou can see the graph of this transaction in the transaction view of the IDE:\r\n```",
        "createdAt" : "2019-06-17T14:38:25Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:\n+\n+- Bob submits the transaction so he's the authorizer on the root transaction.\n+- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob and ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer.\n+- The consequences of the ``Send_Iou`` action are authorized by its actors, Bob, as well as signatories of the contract on which the action was taken. That's Charlie in this case, so the consequences are  authorized by both Bob and Charlie.\n+- The consequences contain a single action, which is a ``Mutual_Exercise`` with Charlie as ``newOwner`` on an ``Iou`` with ``issuer`` alice and ``owner`` Bob. The required authorizers of the action are the ``owner``, Bob, and the ``newOwner``, Charlie, which mathes the parent's authorizers.\n+- The consequences of ``Mutual_Transfer`` are authorized by the actors (Bob and Charlie), as well as the signatories on the Iou (Alice and Bob).\n+- The single action on the consequences, the creation of an Iou with ``issuer`` Alice and ``owner`` Charlie has required authorizers Alice and Charlie, which is a proper subset of the parent's authorizers.\n+\n+The graph of this transaction can be seen in the transaction view of the IDE:"
  },
  {
    "id" : "561448a3-53e8-413c-8872-2f7c7c4db1d0",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "346db4ea-e732-4ca4-bd99-eb9808a9e188",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nThe consequences of ``TryB`` are authorized by both Alice and Bob, but the action ``TryA`` only has Alice as an actor and Alice is the only signatory on the contract.\r\n\r\nTherefore, the consequences of ``TryA`` are only authorized by Alice. Bob's authority is now missing to create the flipped ``NonTransitive`` so the transaction fails.\r\n```",
        "createdAt" : "2019-06-17T14:38:57Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:\n+\n+- Bob submits the transaction so he's the authorizer on the root transaction.\n+- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob and ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer.\n+- The consequences of the ``Send_Iou`` action are authorized by its actors, Bob, as well as signatories of the contract on which the action was taken. That's Charlie in this case, so the consequences are  authorized by both Bob and Charlie.\n+- The consequences contain a single action, which is a ``Mutual_Exercise`` with Charlie as ``newOwner`` on an ``Iou`` with ``issuer`` alice and ``owner`` Bob. The required authorizers of the action are the ``owner``, Bob, and the ``newOwner``, Charlie, which mathes the parent's authorizers.\n+- The consequences of ``Mutual_Transfer`` are authorized by the actors (Bob and Charlie), as well as the signatories on the Iou (Alice and Bob).\n+- The single action on the consequences, the creation of an Iou with ``issuer`` Alice and ``owner`` Charlie has required authorizers Alice and Charlie, which is a proper subset of the parent's authorizers.\n+\n+The graph of this transaction can be seen in the transaction view of the IDE:\n+\n+.. code-block:: none\n+\n+  TX #12 1970-01-01T00:00:00Z (Parties:269:3)\n+  #12:0\n+     known to (since): 'Bob' (#12), 'Charlie' (#12)\n+  > 'Bob' exercises Send_Iou on #10:0 (Parties:IouSender)\n+            with\n+              iouCid = #11:3\n+      children:\n+      #12:1\n+         known to (since): 'Bob' (#12), 'Charlie' (#12)\n+      > fetch #11:3 (Parties:Iou)\n+\n+      #12:2\n+         known to (since): 'Bob' (#12), 'Alice' (#12), 'Charlie' (#12)\n+      > 'Bob', 'Charlie' exercises Mutual_Transfer on #11:3 (Parties:Iou)\n+                           with\n+                             newOwner = 'Charlie'\n+          children:\n+          #12:3\n+             known to (since): 'Charlie' (#12), 'Alice' (#12), 'Bob' (#12)\n+          > create Parties:Iou\n+              with\n+                issuer = 'Alice';\n+                owner = 'Charlie';\n+                cash =\n+                  (Parties:Cash with\n+                     currency = \"USD\"; amount = 100.0)\n+\n+Note that authority is not automatically transferred transitively.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- NON_TRANSITIVE_BEGIN\n+  :end-before: -- NON_TRANSITIVE_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- NON_TRANSITIVE_SCENARIO_BEGIN\n+  :end-before: -- NON_TRANSITIVE_SCENARIO_END\n+\n+The consequences of ``TryB`` are authorized by both Alice and Bob, but the action ``TryA`` only has Alice and an actor and Alice is the only signatory on the contract. Therefore, the consequences of ``TryA`` are only authorized by Alice. Bobs authority is now missing to create the flipped ``NonTransitive`` so the transaction fails."
  },
  {
    "id" : "8735e2f4-a38d-4d53-bb42-9c5bb6696fbd",
    "prId" : 1717,
    "comments" : [
      {
        "id" : "079afa0d-9b48-4d9c-93fe-f3550e0bab2e",
        "parentId" : null,
        "author" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "body" : "```suggestion\r\nNext up\r\n```",
        "createdAt" : "2019-06-17T14:39:13Z",
        "updatedAt" : "2019-06-18T09:05:02Z",
        "lastEditedBy" : {
          "login" : "bethaitman",
          "name" : "Beth Aitman",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/3482051?u=97f3942927ae304a99251ea448bb8b65b6024e74&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "64d0389f2c6ccd0a16f369739cc879b850f52d78",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,197 @@\n+.. Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+.. SPDX-License-Identifier: Apache-2.0\n+\n+6 Parties and Authority\n+=======================\n+\n+DAML is designed for distributed applications involving mutually distrusting parties. In a well constructed contract model, all parties have strong guarantees that nobody cheats or circumvents the rules laid out by templates and choices. In this section you will learn about DAML's authorization rules and how to develop contract models that give all parties the required guarantees. In particular, you'll learn how to\n+\n+- Pass authority from one contract to another\n+- Write advanced choices\n+- Reason through DAML's Authorization model\n+\n+Preventing iou revokation\n+-------------------------\n+\n+The ``SimpleIou`` contract from :doc:`4_Transformations` and :doc:`5_Restrictions` has one major problem: The contract is only signed by the ``issuer``. The signatories are the parties with the power to create and archive contracts. If Alice gave Bob a ``SimpleIou`` for $100 in exchange for some goods, she could just archive it again after receiving the goods. Bob would have a record such actions, but would have to resort to off-ledger means to get his money back.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_BEGIN\n+  :end-before: -- SIMPLE_IOU_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SIMPLE_IOU_SCENARIO_BEGIN\n+  :end-before: -- SIMPLE_IOU_SCENARIO_END\n+\n+For a party to have any guarantees that only those transformations specified in the choices are actually followed, they either need to be a signatory themselves, or trust one of the signatories to not agree to transactions that archive and re-create contracts in unexpected ways. To make the ``SimpleIou`` safe for Bob, you need to add him as a signatory.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_BEGIN\n+  :end-before: -- IOU_END\n+\n+There's a new problem here: There is no way for Alice to issue or transfer this ``Iou`` to Bob. To get an ``Iou`` with Bob's signature as ``owner`` onto the ledger, his authority is needed.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_SCENARIO_BEGIN\n+  :end-before: -- IOU_SCENARIO_END\n+\n+This may seem awkward, but notice that the ``ensure`` clause is gone from the ``Iou`` again. The above ``Iou`` can contain negative values so Bob should be glad that ``Alice`` cannot put his signature on any ``Iou``.\n+\n+You'll now learn a couple of common of ways of buildng issuance and transfer workflows for the above ``Iou``, before diving into the authorization model in full.\n+\n+Use propose-accept workflows for one-off authorizaiton\n+------------------------------------------------------\n+\n+If there is no standing relationship between Alice and Bob, Alice can propose the issuance of an Iou to Bob, giving him the choice to accept. You can do so by introducing a proposal contract ``IouProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_BEGIN\n+  :end-before: -- IOU_PROPOSAL_END\n+\n+Note how we have used the fact that templates are records here to store the ``Iou`` in a single field.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_PROPOSAL_SCENARIO_BEGIN\n+  :end-before: -- IOU_PROPOSAL_SCENARIO_END\n+\n+The ``IouProposal`` contract carries the authorithy of ``iou.issuer`` by virtue of them being a signatory. By exercising the ``IouProposal_Accept`` choice, Bob adds his authority to that of Alice, which is why an ``Iou`` with both signatories can be created in the context of that choice.\n+\n+The choice is called ``IouProposal_Accept``, not ``Accept``, because propose-accept patterns are very common. In fact, you'll see another one just below. As each choice defines a record type, you cannot have two choices of the same name in scope. It's a good idea to qualify choice names to ensure uniqueness.\n+\n+The above solves issuance, but not transfers. You can solve transfers exactly the same way, though, by creating a ``TransferProposal``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- TRANSFER_PROPOSAL_BEGIN\n+  :end-before: -- TRANSFER_PROPOSAL_END\n+\n+In addition to defining the signatories of a contract, ``signatory`` can also be used to extract the signatories from another contract. Instead of writing ``signatory (signatory iou)``, you could write ``signatory iou.issuer, iou.owner``.\n+\n+Note also how ``newOwner`` is given multiple choices using a single ``controller newOwner can`` block. The ``IouProposal`` had a single signatory so it could be cancelled easily by archiving it. Without a ``Cancel `` choice, the ``newOwner`` could abuse an open TransferProposal as an option. The triple ``Accept``, ``Reject``, ``Cancel`` is common to most proposal templates.\n+\n+To allow an ``iou.owner`` to create such a proposal, you need to give them the choice to propose a transfer on the ``Iou`` contract. The choice looks just like the above ``Transfer`` choice, except that a ``IouTransferProposal`` is created instead of an ``Iou``:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- PROPOSE_TRANSFER_BEGIN\n+  :end-before: -- PROPOSE_TRANSFER_END\n+\n+Bob can now transfer his ``Iou``. The transfer workflow can even be used for issuance:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- IOU_TRANSFER_SCENARIO_BEGIN\n+  :end-before: -- IOU_TRANSFER_SCENARIO_END\n+\n+Use role contracts for ongoing authorization\n+--------------------------------------------\n+\n+Many actions, like the issuance of assets or their transfer, can be pre-agreed. You can represent this succinctly in DAML through relationship or role contracts.\n+\n+Jointly, an ``owner`` and ``newOwner`` can transfer an asset, as demonstrated in the scenrario above. In :doc:`7_Composing`, you will see how to compose the ``ProposeTransfer`` and ``IouTransferProposal_Accept`` choices into a single new choice, but for now, here is a different way. You can give them the joint right to transfer an iou:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- MUTUAL_TRANSFER_BEGIN\n+  :end-before: -- MUTUAL_TRANSFER_END\n+\n+Up to now, the controllers of choices were known from the current contract. Here, the ``newOwner`` variable is part of the choice arguments, not the ``Iou``. The above syntax is an alternative to ``controller c can``, which allows for this. Such choices live outside any ``controller c can`` block. They declared using the ``choice`` keyword, and have an extra clause ``controller c``, which takes the place of ``controller c can``, and has access to to the choice arguments.\n+\n+This is also the first time we have shown a choice with more than one controller. If multiple controllers are specified, the authority of *all* the controllers is needed. Here, neither ``owner``, nor ``newOwner`` can execute a transfer unilaterally, hence the name ``Mutual_Transfer``.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_ROLE_BEGIN\n+  :end-before: -- SENDER_ROLE_END\n+\n+The above ``IouSender`` contract now gives a one party, the ``sender`` the right to send ``Iou`` contracts with positive amounts to a ``receiver``. The ``nonconsuming`` keyword on the choice ``Send_Iou`` changes the behaviour of the choice so that the contract it's exercised on does not get archived when the choice is exercised. That way the ``sender`` can use the contract to send multiple Ious. Here it is in action:\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- SENDER_SCENARIO_BEGIN\n+  :end-before: -- SENDER_SCENARIO_END\n+\n+DAML's authorization model\n+--------------------------\n+\n+Hopefully, the above will have given you a good intuition for how authority is passed around in DAML. In this section you'll learn about  the formal authorization model to allow you to reason through your contract models. This will allow you to construct them in such a way that you don't run into authorization errors at runtime, or, worse still, allow malicious transactions.\n+\n+In :ref:`choices` you learned that a transaction is, equivalently, a tree of transactions, or a forest of actions, where each transaction is a list of actions, and each action has a child-transaction called its consequences.\n+\n+Each action has a set of *required authorizers*:\n+\n+- The required authorizers of an exercise action are specified as the controllers on the corresponding choice. Remember that ``Archive`` and ``archive`` are just an implicit choice with the signatories as controllers.\n+- The required authorizers of a create action are the signatories of the contract.\n+- The required authorizers of a fetch (which also includes ``fetchByKey``) are somewhat dynamic and covered later.\n+\n+Each transaction has a set of *authorizers*:\n+\n+- The root transaction of a commit is authorized by the submitting party.\n+- The consequences of an exercise action are authorized by the actors of that action plus the signatories of the contract on which the action was taken.\n+\n+The authorization rule is that the required authorizers of every action are a subset of the authorizers of the parent transaction.\n+\n+Take, for example, the final transaction in the scenario of the the source file for this section. Ignoring fetches:\n+\n+- Bob submits the transaction so he's the authorizer on the root transaction.\n+- The root transaction has a single action, which is to exercise ``Send_Iou`` on a ``IouSender`` contract with Bob and ``sender`` and Charlie as ``receiver``. Since the controller of that choice is the ``sender``, Bob is the required authorizer.\n+- The consequences of the ``Send_Iou`` action are authorized by its actors, Bob, as well as signatories of the contract on which the action was taken. That's Charlie in this case, so the consequences are  authorized by both Bob and Charlie.\n+- The consequences contain a single action, which is a ``Mutual_Exercise`` with Charlie as ``newOwner`` on an ``Iou`` with ``issuer`` alice and ``owner`` Bob. The required authorizers of the action are the ``owner``, Bob, and the ``newOwner``, Charlie, which mathes the parent's authorizers.\n+- The consequences of ``Mutual_Transfer`` are authorized by the actors (Bob and Charlie), as well as the signatories on the Iou (Alice and Bob).\n+- The single action on the consequences, the creation of an Iou with ``issuer`` Alice and ``owner`` Charlie has required authorizers Alice and Charlie, which is a proper subset of the parent's authorizers.\n+\n+The graph of this transaction can be seen in the transaction view of the IDE:\n+\n+.. code-block:: none\n+\n+  TX #12 1970-01-01T00:00:00Z (Parties:269:3)\n+  #12:0\n+     known to (since): 'Bob' (#12), 'Charlie' (#12)\n+  > 'Bob' exercises Send_Iou on #10:0 (Parties:IouSender)\n+            with\n+              iouCid = #11:3\n+      children:\n+      #12:1\n+         known to (since): 'Bob' (#12), 'Charlie' (#12)\n+      > fetch #11:3 (Parties:Iou)\n+\n+      #12:2\n+         known to (since): 'Bob' (#12), 'Alice' (#12), 'Charlie' (#12)\n+      > 'Bob', 'Charlie' exercises Mutual_Transfer on #11:3 (Parties:Iou)\n+                           with\n+                             newOwner = 'Charlie'\n+          children:\n+          #12:3\n+             known to (since): 'Charlie' (#12), 'Alice' (#12), 'Bob' (#12)\n+          > create Parties:Iou\n+              with\n+                issuer = 'Alice';\n+                owner = 'Charlie';\n+                cash =\n+                  (Parties:Cash with\n+                     currency = \"USD\"; amount = 100.0)\n+\n+Note that authority is not automatically transferred transitively.\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- NON_TRANSITIVE_BEGIN\n+  :end-before: -- NON_TRANSITIVE_END\n+\n+.. literalinclude:: daml/daml-intro-6/Parties.daml\n+  :language: daml\n+  :start-after: -- NON_TRANSITIVE_SCENARIO_BEGIN\n+  :end-before: -- NON_TRANSITIVE_SCENARIO_END\n+\n+The consequences of ``TryB`` are authorized by both Alice and Bob, but the action ``TryA`` only has Alice and an actor and Alice is the only signatory on the contract. Therefore, the consequences of ``TryA`` are only authorized by Alice. Bobs authority is now missing to create the flipped ``NonTransitive`` so the transaction fails.\n+\n+Next Up"
  }
]