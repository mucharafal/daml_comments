[
  {
    "id" : "bd01e7ff-af75-4914-957d-f574116bd2ad",
    "prId" : 4693,
    "comments" : [
      {
        "id" : "7e080601-f287-404b-a5dd-46771fe86abb",
        "parentId" : null,
        "author" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "body" : "application id is currently also used, so this should be the triple `(submitter, application-id, command-id)`, unless we're changing that with the new time model?",
        "createdAt" : "2020-03-02T16:13:43Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "c6e73c43-0f57-4823-8e17-7c3fa616833c",
        "parentId" : "7e080601-f287-404b-a5dd-46771fe86abb",
        "author" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "body" : "The conclusion from the design document was that the application ID should not be part of the deduplication key.",
        "createdAt" : "2020-03-02T16:30:17Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "f26a9d02-4a04-4ab2-be6d-9a49747c9fa2",
        "parentId" : "7e080601-f287-404b-a5dd-46771fe86abb",
        "author" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "body" : "I stand corrected. We'll need to fix this in kvutils. Can you drive that change @rautenrieth-da? Should be pretty straightforward since we can still break backwards compatibility.",
        "createdAt" : "2020-03-06T16:37:07Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a9121fcfd12a70094e22694eaed833e2cf308682",
    "line" : null,
    "diffHunk" : "@@ -59,6 +59,23 @@ Commands can be labeled with two application-specific IDs, both of which are ret\n \n For full details, see :ref:`the proto documentation for the service <com.digitalasset.ledger.api.v1.CommandSubmissionService>`.\n \n+.. _command-submission-service-deduplication:\n+\n+Command deduplication\n+---------------------\n+\n+The command submission service deduplicates submitted commands:\n+\n+- Applications can assign a \"time to live\" (TTL) value to each command.\n+- Duplicate command submissions (using the same submitter and command ID) will be ignored until either the TTL of the original command has elapsed or the original submission was rejected, whichever comes first."
  },
  {
    "id" : "b860f97a-9b23-45be-a962-e6130ec63db7",
    "prId" : 4693,
    "comments" : [
      {
        "id" : "9dea001a-8835-4019-bc09-66f7ba7b5729",
        "parentId" : null,
        "author" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "body" : "the result of a submission is returned via command completion service and not by command submission service, unless this section is actually talking about the command service. we may also get an OK status, but a duplicate command error on the command completion service for ledgers that also deduplicate outside participants.",
        "createdAt" : "2020-03-02T16:15:25Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "651ae39c-53f6-4153-8139-22f304fb8552",
        "parentId" : "9dea001a-8835-4019-bc09-66f7ba7b5729",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "Think of the result of a submission in terms of [`SubmissionResult`](https://github.com/digital-asset/daml/blob/master/ledger/participant-state/src/main/scala/com/daml/ledger/participant/state/v1/SubmissionResult.scala).",
        "createdAt" : "2020-03-02T16:27:57Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "8e4ba4f2-a3e6-465d-9132-329b425f1644",
        "parentId" : "9dea001a-8835-4019-bc09-66f7ba7b5729",
        "author" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "body" : "This is talking about the submission service - it returns either an empty response (if the command was successfully submitted), or an error (e.g., if there were command interpretation errors).\r\n\r\nDeduplicated submissions will return the same response as the original submission, if that information is available.",
        "createdAt" : "2020-03-02T16:32:48Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a9121fcfd12a70094e22694eaed833e2cf308682",
    "line" : null,
    "diffHunk" : "@@ -59,6 +59,23 @@ Commands can be labeled with two application-specific IDs, both of which are ret\n \n For full details, see :ref:`the proto documentation for the service <com.digitalasset.ledger.api.v1.CommandSubmissionService>`.\n \n+.. _command-submission-service-deduplication:\n+\n+Command deduplication\n+---------------------\n+\n+The command submission service deduplicates submitted commands:\n+\n+- Applications can assign a \"time to live\" (TTL) value to each command.\n+- Duplicate command submissions (using the same submitter and command ID) will be ignored until either the TTL of the original command has elapsed or the original submission was rejected, whichever comes first.\n+- Command deduplication is only guaranteed to work if all commands are submitted to the same participant. On some ledgers, the deduplication may also work across participants.\n+- A command submission will return:\n+  - The result of the submission, if the command was submitted for the first time"
  },
  {
    "id" : "cbe0ded5-8c43-4159-828d-8a06d33cddaa",
    "prId" : 4693,
    "comments" : [
      {
        "id" : "01f0f5d0-1ad9-4798-b1a3-e9ad84498516",
        "parentId" : null,
        "author" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "body" : "Both command submission service and command service's SubmitAndWait return `google.protobuf.Empty` on success. I think it is misleading to talk about \"result\" here, when it's usually an empty message (the exception being the other methods in `CommandService`).",
        "createdAt" : "2020-03-02T16:16:34Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "dajmaki",
          "name" : "Jussi Mäki",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/19684330?u=abb996187e6b472110abdd8dc3c27c4fc0140b92&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "9457484e-ec0d-4b2e-acdf-ce95f4bfda19",
        "parentId" : "01f0f5d0-1ad9-4798-b1a3-e9ad84498516",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "We've been postponing changing this due to it being a breaking change. It never should've been just `Empty`. Maybe we change it for DAML 1.0?",
        "createdAt" : "2020-03-02T16:29:41Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "2a6170d0-2cb8-447b-8dca-9f0ac2a85a79",
        "parentId" : "01f0f5d0-1ad9-4798-b1a3-e9ad84498516",
        "author" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "body" : "I see that it's misleading. As noted above, this is talking about returning either `google.protobuf.Empty` if the original submission was successful or the same gRPC error as the original submission if the original submission failed.",
        "createdAt" : "2020-03-02T16:35:23Z",
        "updatedAt" : "2020-03-09T11:53:08Z",
        "lastEditedBy" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a9121fcfd12a70094e22694eaed833e2cf308682",
    "line" : null,
    "diffHunk" : "@@ -59,6 +59,23 @@ Commands can be labeled with two application-specific IDs, both of which are ret\n \n For full details, see :ref:`the proto documentation for the service <com.digitalasset.ledger.api.v1.CommandSubmissionService>`.\n \n+.. _command-submission-service-deduplication:\n+\n+Command deduplication\n+---------------------\n+\n+The command submission service deduplicates submitted commands:\n+\n+- Applications can assign a \"time to live\" (TTL) value to each command.\n+- Duplicate command submissions (using the same submitter and command ID) will be ignored until either the TTL of the original command has elapsed or the original submission was rejected, whichever comes first.\n+- Command deduplication is only guaranteed to work if all commands are submitted to the same participant. On some ledgers, the deduplication may also work across participants.\n+- A command submission will return:\n+  - The result of the submission, if the command was submitted for the first time\n+  - The status error ALREADY_EXISTS, if the command was deduplicated and the result of the first submission is unknown\n+  - The result of the original submission, if the command was deduplicated and the result of the original submission is known"
  }
]