[
  {
    "id" : "0f158517-47d0-4cba-a04c-4e8ae8c62a2b",
    "prId" : 1568,
    "comments" : [
      {
        "id" : "1123199d-1b1a-42f1-af9a-833ff588c72a",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "Note that this will fail hard if you happen to have an invalid token in `GITHUB_API_TOKEN`.",
        "createdAt" : "2019-06-11T13:10:47Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "33957a6d478ba3815e81a67c338bbe4c3a486f19",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+set -euo pipefail\n+\n+GITHUB_API_TOKEN=${GITHUB_API_TOKEN:-\"\"}\n+GOOGLE_APPLICATION_CREDENTIALS_CONTENT=${GOOGLE_APPLICATION_CREDENTIALS_CONTENT:-\"\"}\n+\n+#sets LATEST_SDK_WITH_TIME\n+getLatestSdk() {\n+  local TMP_FILE=$(mktemp)\n+  local JQ_COMMAND='. | map(select(.prerelease == false)) | map([.tag_name,.published_at]) | map(.[0] + \",\" + .[1] + \",\" + (.[1]|fromdate|tostring))[]'\n+  if [ -n \"$GITHUB_API_TOKEN\" ]; then\n+    $(curl -H \"Authorization: $GITHUB_API_TOKEN\" https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")"
  },
  {
    "id" : "314a0df5-9e75-48c4-8048-55233952b06b",
    "prId" : 1568,
    "comments" : [
      {
        "id" : "d0303785-8e40-4caf-b6ef-3444273fda8f",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "Why the nested call here? I do not expect `curl` to return valid bash commands on its stderr.",
        "createdAt" : "2019-06-11T13:11:44Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "2148ef42-44f5-4e0b-9d97-2ac22e3fcf53",
        "parentId" : "d0303785-8e40-4caf-b6ef-3444273fda8f",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "ðŸ‘ ",
        "createdAt" : "2019-06-11T14:06:12Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "33957a6d478ba3815e81a67c338bbe4c3a486f19",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+set -euo pipefail\n+\n+GITHUB_API_TOKEN=${GITHUB_API_TOKEN:-\"\"}\n+GOOGLE_APPLICATION_CREDENTIALS_CONTENT=${GOOGLE_APPLICATION_CREDENTIALS_CONTENT:-\"\"}\n+\n+#sets LATEST_SDK_WITH_TIME\n+getLatestSdk() {\n+  local TMP_FILE=$(mktemp)\n+  local JQ_COMMAND='. | map(select(.prerelease == false)) | map([.tag_name,.published_at]) | map(.[0] + \",\" + .[1] + \",\" + (.[1]|fromdate|tostring))[]'\n+  if [ -n \"$GITHUB_API_TOKEN\" ]; then\n+    $(curl -H \"Authorization: $GITHUB_API_TOKEN\" https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")\n+  else\n+    $(curl https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")"
  },
  {
    "id" : "9b1307f3-1656-4e00-863a-ec21796457d7",
    "prId" : 1568,
    "comments" : [
      {
        "id" : "64237916-db63-4605-b274-a403be1f9324",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "The final script at the end would be easier to follow if your functions returned their results rather than storing them in global variables.",
        "createdAt" : "2019-06-11T13:12:29Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "1cf6482f-e006-49e6-ac25-4bb7bbe3d62b",
        "parentId" : "64237916-db63-4605-b274-a403be1f9324",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "I'm not well versed in bash actually, but I read this: https://www.linuxjournal.com/content/return-values-bash-functions",
        "createdAt" : "2019-06-11T14:03:12Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "33957a6d478ba3815e81a67c338bbe4c3a486f19",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+set -euo pipefail\n+\n+GITHUB_API_TOKEN=${GITHUB_API_TOKEN:-\"\"}\n+GOOGLE_APPLICATION_CREDENTIALS_CONTENT=${GOOGLE_APPLICATION_CREDENTIALS_CONTENT:-\"\"}\n+\n+#sets LATEST_SDK_WITH_TIME\n+getLatestSdk() {\n+  local TMP_FILE=$(mktemp)\n+  local JQ_COMMAND='. | map(select(.prerelease == false)) | map([.tag_name,.published_at]) | map(.[0] + \",\" + .[1] + \",\" + (.[1]|fromdate|tostring))[]'\n+  if [ -n \"$GITHUB_API_TOKEN\" ]; then\n+    $(curl -H \"Authorization: $GITHUB_API_TOKEN\" https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")\n+  else\n+    $(curl https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")\n+  fi\n+  local RELEASES=$(jq -r \"$JQ_COMMAND\" \"$TMP_FILE\")\n+  local LAST_COMMAND_RESULT=$?\n+  if [ $LAST_COMMAND_RESULT -eq 2 ]; then\n+    echo \"ERROR: could not read daml releases `cat $TMP_FILE`\"\n+    return 1\n+  fi\n+  LATEST_SDK_WITH_TIME=$(echo $RELEASES | awk '{if(substr($1,1,1)==\"v\") print substr($1,2); else print substr($1,1);}')"
  },
  {
    "id" : "34443cd2-4752-495a-9101-25930ad618c3",
    "prId" : 1568,
    "comments" : [
      {
        "id" : "ee220a31-dd3e-432e-b9d3-077a1648c659",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "I'm not sure I understand the reasoning behind this. What is `gcloud container images list-tags` returning? Why would we ever care about timestamps?",
        "createdAt" : "2019-06-11T13:15:58Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "fa108c5d-26f0-47d7-83e0-28a6dd7aff1d",
        "parentId" : "ee220a31-dd3e-432e-b9d3-077a1648c659",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "I'm checking for timestamps so that if a version of the sdk was updated I will rebuild as well...",
        "createdAt" : "2019-06-11T14:03:04Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "a596d692-9c9c-4703-9739-3b14d41317a5",
        "parentId" : "ee220a31-dd3e-432e-b9d3-077a1648c659",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "We never update existing releases.",
        "createdAt" : "2019-06-11T14:31:21Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "09b1e154-cdbd-40e8-92a9-5bc786faf293",
        "parentId" : "ee220a31-dd3e-432e-b9d3-077a1648c659",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "hey - I'm going to grab the timestamps anyway just for logging information. But I'm not basing any logic on the timestamp anymore",
        "createdAt" : "2019-06-11T18:14:44Z",
        "updatedAt" : "2019-06-11T18:23:19Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "33957a6d478ba3815e81a67c338bbe4c3a486f19",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,81 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+set -euo pipefail\n+\n+GITHUB_API_TOKEN=${GITHUB_API_TOKEN:-\"\"}\n+GOOGLE_APPLICATION_CREDENTIALS_CONTENT=${GOOGLE_APPLICATION_CREDENTIALS_CONTENT:-\"\"}\n+\n+#sets LATEST_SDK_WITH_TIME\n+getLatestSdk() {\n+  local TMP_FILE=$(mktemp)\n+  local JQ_COMMAND='. | map(select(.prerelease == false)) | map([.tag_name,.published_at]) | map(.[0] + \",\" + .[1] + \",\" + (.[1]|fromdate|tostring))[]'\n+  if [ -n \"$GITHUB_API_TOKEN\" ]; then\n+    $(curl -H \"Authorization: $GITHUB_API_TOKEN\" https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")\n+  else\n+    $(curl https://api.github.com/repos/digital-asset/daml/releases -s > \"$TMP_FILE\")\n+  fi\n+  local RELEASES=$(jq -r \"$JQ_COMMAND\" \"$TMP_FILE\")\n+  local LAST_COMMAND_RESULT=$?\n+  if [ $LAST_COMMAND_RESULT -eq 2 ]; then\n+    echo \"ERROR: could not read daml releases `cat $TMP_FILE`\"\n+    return 1\n+  fi\n+  LATEST_SDK_WITH_TIME=$(echo $RELEASES | awk '{if(substr($1,1,1)==\"v\") print substr($1,2); else print substr($1,1);}')\n+}\n+\n+dockerAuth() {\n+  if [ -n \"$GOOGLE_APPLICATION_CREDENTIALS_CONTENT\" ]; then\n+    GCS_KEY=$(mktemp)\n+    echo \"$GOOGLE_APPLICATION_CREDENTIALS_CONTENT\" > $GCS_KEY\n+    gcloud auth activate-service-account --key-file=$GCS_KEY\n+\n+    docker-credential-gcr config --token-source=\"gcloud\"\n+    docker-credential-gcr configure-docker\n+  fi\n+}\n+\n+#sets WEBIDE_TS\n+getImageTimestampByVersion() {\n+  local VERSION=$1\n+  local TMP_FILE=$(mktemp)\n+  #complications here are parsing the datetime and conforming it to strptime readable dates\n+  local JQ_COMMAND=\". | map(select(.tags as \\$t | \\\"$VERSION\\\" | IN(\\$t[]))) | map(.timestamp.datetime)[] | sub(\\\" \\\";\\\"T\\\") | sub(\\\"(?<before>.*):\\\"; (.before)) | strptime(\\\"%Y-%m-%dT%H:%M:%S%z\\\") | todate | fromdate\"\n+  #echo \"running jq command: $JQ_COMMAND\"\n+  $(gcloud container images list-tags gcr.io/da-gcp-web-ide-project/daml-webide --format=json > $TMP_FILE)"
  }
]