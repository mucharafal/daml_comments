[
  {
    "id" : "46e55c7c-9025-4d01-acd6-50341f345ce9",
    "prId" : 897,
    "comments" : [
      {
        "id" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Do we know that `fp` is always absolute? Why? If not, have you checked that the conversion logic on Windows doesn’t fall over?",
        "createdAt" : "2019-05-03T17:39:25Z",
        "updatedAt" : "2019-05-03T17:39:54Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "d2134738-0639-422f-bf21-953252902347",
        "parentId" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "author" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "body" : "Yup, the only place this is called by is `updateFileDiagnostics`, my current PR is turning this FilePath into a Uri when you pass it in as it makes more sense",
        "createdAt" : "2019-05-03T17:43:02Z",
        "updatedAt" : "2019-05-03T17:43:02Z",
        "lastEditedBy" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "9863b946-ffdf-4105-83fb-320930815b40",
        "parentId" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "I still don’t get it, why do we know that `updateFileDiagnostics` always uses an absolute path? Afaict, it just uses whatever is used as the key in Shake which is definitely not guaranteed to be absolute.",
        "createdAt" : "2019-05-03T17:44:17Z",
        "updatedAt" : "2019-05-03T17:44:17Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "865cb5f9-cc3f-4293-97bd-63b280cfd617",
        "parentId" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "author" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "body" : "Right you are, it should be `afp'` instead of `afp`",
        "createdAt" : "2019-05-03T17:48:49Z",
        "updatedAt" : "2019-05-03T17:48:49Z",
        "lastEditedBy" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "75273475-8802-4aa7-907e-2aa914fcf5ae",
        "parentId" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "That would only solve one direction, you would need to relativize when going the other direction. Otherwise you might end up with the same file represented twice by different keys which is going to be a mess. The reason why this works atm is probably because the IDE gets the initial filepath from VSCode which is absolute so we only ever use absolute filepaths.\r\n\r\nThis issue seems to have existed before, so I would just leave things for now (unless we see an actual issue) and rethink this carefully. It seems like we might want to move to URIs for keys in our Shake graph and then relativize at the edges where we care about it (at least when converting to DAML-LF but probably also in error messages printed to a terminal).",
        "createdAt" : "2019-05-03T18:02:01Z",
        "updatedAt" : "2019-05-03T18:02:02Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "a3f88005-36f5-4172-9e05-e30d7c946df5",
        "parentId" : "03253e36-d2f8-49bb-9ee5-6ce0a4e7dcc4",
        "author" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "body" : "https://github.com/digital-asset/daml/pull/901\r\nThis addresses one facet of the problem, I agree that shake keys should be Uris, in practice this gets a little hairy as some paths in the shake graphs really don't want to be made absolute",
        "createdAt" : "2019-05-03T18:05:15Z",
        "updatedAt" : "2019-05-03T18:05:16Z",
        "lastEditedBy" : {
          "login" : "DavidM-D",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/11191170?u=3edc6e08b7c7f0d980a6dc81e5a2ce49dd1ef0f0&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "1fff754e0a8427f79531bada2fa8e80e997f29f5",
    "line" : 10,
    "diffHunk" : "@@ -293,11 +293,11 @@ eventSlinger\n eventSlinger loggerH eventChan notifChan =\n     forever $ do\n         mbFatalErr <- atomically $ readTChan eventChan >>= \\case\n-            Compiler.EventFileDiagnostics (Compiler.Uri uri, diags) -> do\n+            Compiler.EventFileDiagnostics (fp, diags) -> do\n                 writeTChan notifChan\n                     $ PublishDiagnostics\n                     $ PublishDiagnosticsParams\n-                    (Tagged uri)\n+                    (Tagged $ Compiler.getUri $ Compiler.filePathToUri fp)"
  }
]