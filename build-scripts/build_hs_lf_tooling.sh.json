[
  {
    "id" : "65ba8599-7751-4083-935d-53a6174570b6",
    "prId" : 7246,
    "comments" : [
      {
        "id" : "800dae1d-412d-49bb-aeea-65ad5b1be432",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "```suggestion\r\n    cabal v2-sdist\r\n```",
        "createdAt" : "2020-08-31T07:33:28Z",
        "updatedAt" : "2020-09-01T01:49:21Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "9be674ab1f0cc3f87fcc5463d67bc9df43eda142",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,187 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+\n+set -eou pipefail\n+\n+if [ \"$#\" -ne 1 ]; then\n+    echo \"Expected exactly one argument.\"\n+    echo \"Usage: ./build_packages.sh TARGET_DIR\"\n+    exit 1\n+fi\n+\n+TARGET_DIR=$PWD/$1\n+cd \"$(dirname ${BASH_SOURCE[0]})/..\"\n+\n+mkdir -p $TARGET_DIR\n+\n+package_from_dir() {\n+    local dir=$1\n+    if [ ! -d $dir ]; then\n+        echo \"Directory $dir does not exist!\"\n+        exit 1\n+    fi\n+    pushd $dir\n+    cabal new-sdist"
  },
  {
    "id" : "0e655119-c905-4b77-8db1-06171ba81373",
    "prId" : 7246,
    "comments" : [
      {
        "id" : "c4535099-8b81-424a-8ad6-6931e0c1c22a",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Custom setup scripts always end up causing problems at some point ime. Why did you decide against the approach the old script used which just used our Bazel setup to build the generated code and included that?",
        "createdAt" : "2020-08-31T07:35:05Z",
        "updatedAt" : "2020-09-01T01:49:21Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "c7864182-886e-4904-8cee-5344941f4165",
        "parentId" : "c4535099-8b81-424a-8ad6-6931e0c1c22a",
        "author" : {
          "login" : "jberthold-da",
          "name" : "Jost Berthold",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/28879196?u=41dee6fb7ab2761a566b324e2f4e5ad9b577ae0e&v=4"
        },
        "body" : "The extracted library uses `proto-suite-0.4.0.0` instead of the point between-versions used in the daml repo.\r\nTo use the released version, I need the packaged protobuf compiler => calling it in a custom setup.",
        "createdAt" : "2020-08-31T07:59:37Z",
        "updatedAt" : "2020-09-01T01:49:21Z",
        "lastEditedBy" : {
          "login" : "jberthold-da",
          "name" : "Jost Berthold",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/28879196?u=41dee6fb7ab2761a566b324e2f4e5ad9b577ae0e&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "141e5105-4d11-4565-8129-eb1618e32d09",
        "parentId" : "c4535099-8b81-424a-8ad6-6931e0c1c22a",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Can we just switch t a released version in the DAML repo? The more you diverge from the build setup used in the DAML Repo the more likely this is to break in the future.",
        "createdAt" : "2020-08-31T11:12:42Z",
        "updatedAt" : "2020-09-01T01:49:21Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "6c7546d4-49ad-434f-aa46-e7bf58cd63ee",
        "parentId" : "c4535099-8b81-424a-8ad6-6931e0c1c22a",
        "author" : {
          "login" : "jberthold-da",
          "name" : "Jost Berthold",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/28879196?u=41dee6fb7ab2761a566b324e2f4e5ad9b577ae0e&v=4"
        },
        "body" : "Happy to assist you in switching. I don't want to make that change on this PR, though.\r\nIIUC it should be fine to just update the bazel configuration to depend on the (hackage-released) `proto-suite-0.4.0.0`. Is that right @garyverhaegen-da ? I can confirm all code in `daml-lf-proto` written against the generated  `Com.Daml.DamlLfDev.DamlLf*` works with this version.",
        "createdAt" : "2020-09-01T01:48:47Z",
        "updatedAt" : "2020-09-01T01:49:21Z",
        "lastEditedBy" : {
          "login" : "jberthold-da",
          "name" : "Jost Berthold",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/28879196?u=41dee6fb7ab2761a566b324e2f4e5ad9b577ae0e&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "a626b0b9-b9c9-4976-ac89-535e2f1c6aa3",
        "parentId" : "c4535099-8b81-424a-8ad6-6931e0c1c22a",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "I'm actually not very familiar with that side of things, but it seems to me we _are_ depending on the release 0.4.0.0 version of `proto3-suite` per [stack-snapshot.yml](https://github.com/digital-asset/daml/blob/master/stack-snapshot.yaml#L26). What am I missing? Where is that \"in-between version\" we're using defined?",
        "createdAt" : "2020-09-02T10:41:00Z",
        "updatedAt" : "2020-09-02T10:41:01Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "9be674ab1f0cc3f87fcc5463d67bc9df43eda142",
    "line" : 44,
    "diffHunk" : "@@ -0,0 +1,187 @@\n+#!/usr/bin/env bash\n+# Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+# SPDX-License-Identifier: Apache-2.0\n+\n+set -eou pipefail\n+\n+if [ \"$#\" -ne 1 ]; then\n+    echo \"Expected exactly one argument.\"\n+    echo \"Usage: ./build_packages.sh TARGET_DIR\"\n+    exit 1\n+fi\n+\n+TARGET_DIR=$PWD/$1\n+cd \"$(dirname ${BASH_SOURCE[0]})/..\"\n+\n+mkdir -p $TARGET_DIR\n+\n+package_from_dir() {\n+    local dir=$1\n+    if [ ! -d $dir ]; then\n+        echo \"Directory $dir does not exist!\"\n+        exit 1\n+    fi\n+    pushd $dir\n+    cabal new-sdist\n+    cp dist-newstyle/sdist/*.tar.gz \"$TARGET_DIR/\"\n+    rm -rf cabal.tix dist-newstyle/\n+    popd\n+}\n+\n+package_from_dir libs-haskell/da-hs-base\n+# removed the GCP logger from the exposed modules to avoid SdkVersion.hs\n+\n+package_from_dir compiler/daml-lf-ast\n+\n+package_from_dir compiler/daml-lf-proto\n+\n+package_from_dir compiler/daml-lf-reader\n+\n+DIR=$(mktemp -d)\n+mkdir -p \"$DIR/protobuf/com/daml\"\n+cp -RL \"daml-lf/archive/src/main/protobuf/com/daml/daml_lf_dev\" \"$DIR/protobuf/com/daml/\"\n+# generate code from protobuf using the matching tool, as a configure script\n+cat <<EOF >\"$DIR/Setup.hs\""
  }
]