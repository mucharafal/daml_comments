[
  {
    "id" : "d36e3231-f15d-4a0a-8143-8b4b9d51c990",
    "prId" : 7759,
    "comments" : [
      {
        "id" : "2f27f06b-c67b-4009-94fd-cec90ca4d24a",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "Any opinion on `--diff-filter=AM`?",
        "createdAt" : "2020-10-21T09:38:57Z",
        "updatedAt" : "2020-10-21T10:30:45Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "81051978-6bd2-4d9f-8365-2c7401823e24",
        "parentId" : "2f27f06b-c67b-4009-94fd-cec90ca4d24a",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "I'm fine with that. It has the added benefit of not running on untracked files, which shouldn't be a problem.",
        "createdAt" : "2020-10-21T10:02:15Z",
        "updatedAt" : "2020-10-21T10:30:45Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "70b0de95-1831-4e14-93cc-ba79fd4c3d87",
        "parentId" : "2f27f06b-c67b-4009-94fd-cec90ca4d24a",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "We probably want `--diff-filter=ACMRT`. Copied files, renamed files, and type-changed files will all get checked in and need to be scanned.",
        "createdAt" : "2020-10-21T10:02:44Z",
        "updatedAt" : "2020-10-21T10:30:45Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "1bfd8758-bf3f-478c-b8a2-7e1b6811bd7f",
        "parentId" : "2f27f06b-c67b-4009-94fd-cec90ca4d24a",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : ":+1:",
        "createdAt" : "2020-10-21T12:07:04Z",
        "updatedAt" : "2020-10-21T12:07:05Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a3d269125ef505bf497b013d020f466f45d9c549",
    "line" : null,
    "diffHunk" : "@@ -110,12 +110,13 @@ run dade-copyright-headers \"$dade_copyright_arg\" .\n # We do test hlint via Bazel rules but we run it separately\n # to get linting failures early.\n if [ \"$hlint_diff\" = \"true\" ]; then\n-    changed_haskell_files=\"$(git diff --name-only origin/master | grep '\\.hs$' || [[ $? == 1 ]])\"\n-    if [ \"\" != \"$changed_haskell_files\" ]; then\n-        hlint -j4 $changed_haskell_files\n-    fi\n+  #  We do not run on deleted files, or files that have been added since we last rebased onto trunk.\n+  changed_haskell_files=\"$(git diff --name-only --diff-filter=d \"$(git merge-base origin/master HEAD)\" | grep '\\.hs$' || [[ $? == 1 ]])\""
  },
  {
    "id" : "32211460-f43e-48f0-b499-92f535765987",
    "prId" : 5718,
    "comments" : [
      {
        "id" : "30b8eed8-81c9-4c59-a638-1403afd05cab",
        "parentId" : null,
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "I know you didn't do this, but while we're on the subject…\r\n\r\n```suggestion\r\n    changed_haskell_files=\"$(git diff --name-only origin/master | grep '\\.hs$' || [[ $? == 1 ]])\"\r\n```",
        "createdAt" : "2020-04-24T11:45:02Z",
        "updatedAt" : "2020-04-24T11:51:10Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "0214e429a20cb1cee757bf4eaf762b8c931b7993",
    "line" : null,
    "diffHunk" : "@@ -107,19 +107,15 @@ echo \"\\\n # Check for correct copyrights\n run dade-copyright-headers \"$dade_copyright_arg\" .\n \n+# We do test hlint via Bazel rules but we run it separately\n+# to get linting failures early.\n if [ \"$hlint_diff\" = \"true\" ]; then\n     changed_haskell_files=\"$(git diff --name-only origin/master | grep '.hs$' || [[ $? == 1 ]])\""
  },
  {
    "id" : "39044f04-9a3e-4518-a422-8ef9a2e22ce2",
    "prId" : 5114,
    "comments" : [
      {
        "id" : "9f3f12e2-f074-46a6-93de-2b3378137bb4",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "This comment might be a bit outdated by now. Afaik the bazel rules work just fine. The advantage of keeping the separate hlint calls in ./fmt.sh is that this way you get format errors at the very beginning.",
        "createdAt" : "2020-03-20T18:04:15Z",
        "updatedAt" : "2020-03-20T18:04:55Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "56f9ed1c-282d-49a5-a203-da7013212b30",
        "parentId" : "9f3f12e2-f074-46a6-93de-2b3378137bb4",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "Happy to kill it. Should I?",
        "createdAt" : "2020-03-20T18:07:52Z",
        "updatedAt" : "2020-03-20T18:07:52Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "e71a6566-f92d-43d1-95a6-7f87f92c6695",
        "parentId" : "9f3f12e2-f074-46a6-93de-2b3378137bb4",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Yeah I would just kill it.",
        "createdAt" : "2020-03-23T08:16:34Z",
        "updatedAt" : "2020-03-23T08:16:34Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "18750403263e46926baf297b45558d02236f87be",
    "line" : 45,
    "diffHunk" : "@@ -105,18 +113,20 @@ echo \"\\\n # Check for correct copyrights\n run dade-copyright-headers \"$dade_copyright_arg\" .\n \n-# We have a Bazel test that is meant to run HLint, but we're a little sceptical of it\n-# If we get this far, but hlint fails, that's a problem we should fix\n-function bad_hlint() {\n-  echo \"UNEXPECTED HLINT FAILURE: The Bazel rules should have spotted this, please raise a GitHub issue\"\n-}\n-trap bad_hlint EXIT\n-for dir in daml-assistant libs-haskell compiler release language-support; do\n-  run pushd \"$dir\"\n-  run hlint --git -j4\n-  run popd\n-done\n-trap - EXIT\n+if [ \"$hlint_diff\" = \"true\" ]; then\n+    changed_haskell_files=\"$(git diff --name-only origin/master | grep '.hs$')\"\n+    if [ \"\" != \"$changed_haskell_files\" ]; then\n+        hlint -j4 $changed_haskell_files\n+    fi\n+else\n+    # We have a Bazel test that is meant to run HLint, but we're a little"
  },
  {
    "id" : "a6ac49e5-1245-4e2c-a560-6afdd7ca9139",
    "prId" : 5114,
    "comments" : [
      {
        "id" : "490797f5-a656-4237-9a15-14c3ba8d97ca",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Is the `cd` for the different directories no longer necessary?",
        "createdAt" : "2020-03-20T18:04:47Z",
        "updatedAt" : "2020-03-20T18:04:55Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "a9eff487-8fb4-4cbc-b923-70105afb3cf7",
        "parentId" : "490797f5-a656-4237-9a15-14c3ba8d97ca",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "I don't know why it was there; as far as I can tell it was never necessary, hlint tests all the `.hs` files it can find.",
        "createdAt" : "2020-03-20T18:06:40Z",
        "updatedAt" : "2020-03-20T18:06:40Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "6aa50f0b-b8f3-424a-b2cc-f9ea93bea364",
        "parentId" : "490797f5-a656-4237-9a15-14c3ba8d97ca",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "alright then let’s kill it.",
        "createdAt" : "2020-03-23T08:16:46Z",
        "updatedAt" : "2020-03-23T08:16:47Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "18750403263e46926baf297b45558d02236f87be",
    "line" : 48,
    "diffHunk" : "@@ -105,18 +113,20 @@ echo \"\\\n # Check for correct copyrights\n run dade-copyright-headers \"$dade_copyright_arg\" .\n \n-# We have a Bazel test that is meant to run HLint, but we're a little sceptical of it\n-# If we get this far, but hlint fails, that's a problem we should fix\n-function bad_hlint() {\n-  echo \"UNEXPECTED HLINT FAILURE: The Bazel rules should have spotted this, please raise a GitHub issue\"\n-}\n-trap bad_hlint EXIT\n-for dir in daml-assistant libs-haskell compiler release language-support; do\n-  run pushd \"$dir\"\n-  run hlint --git -j4\n-  run popd\n-done\n-trap - EXIT\n+if [ \"$hlint_diff\" = \"true\" ]; then\n+    changed_haskell_files=\"$(git diff --name-only origin/master | grep '.hs$')\"\n+    if [ \"\" != \"$changed_haskell_files\" ]; then\n+        hlint -j4 $changed_haskell_files\n+    fi\n+else\n+    # We have a Bazel test that is meant to run HLint, but we're a little\n+    # sceptical of it If we get this far, but hlint fails, that's a problem we\n+    # should fix\n+    if ! hlint --git -j4; then"
  }
]