[
  {
    "id" : "6b06bc51-2eb6-4807-bfac-4861d90d7747",
    "prId" : 1297,
    "comments" : [
      {
        "id" : "c4d4cfae-6430-4354-a9e8-f81089f3c17f",
        "parentId" : null,
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "Why support insecure websockets at all? Don't we expect to always serve this page under HTTPS, as the HSTS header above suggests?\r\n\r\nAlso, it may be worth setting up `report-to` and `report-uri` entries, so we can know about these problems before they get reported on Twitter in the future. Ed has set up a server for collecting those reports already, you may want to ask him for the values to set.",
        "createdAt" : "2019-05-22T08:54:01Z",
        "updatedAt" : "2019-05-22T19:16:13Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "7f5817a5-f248-479d-8f4f-fe11e238ba31",
        "parentId" : "c4d4cfae-6430-4354-a9e8-f81089f3c17f",
        "author" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "body" : "FYI the value mentioned in [Ed's best practices [internal DA link]](https://digitalasset.atlassian.net/wiki/spaces/SEC/pages/850853931/Web+Site+Web+Services+Security+-+Best+Practices) is:\r\n```report-uri: https://report-uri.digitalasset.com/report-uri```",
        "createdAt" : "2019-05-22T12:37:23Z",
        "updatedAt" : "2019-05-22T19:16:13Z",
        "lastEditedBy" : {
          "login" : "garyverhaegen-da",
          "name" : "Gary Verhaegen",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/45561385?u=eb17386ea66edbd0cd449e33b2d291bf5a1b51cb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "05e6be25-3182-4de2-a35d-ce9eecca7faf",
        "parentId" : "c4d4cfae-6430-4354-a9e8-f81089f3c17f",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "thanks @garyverhaegen-da - I'm adding the report-uri\r\n\r\nI'd like to keep the ws:// as well as it allows me to test locally without too much trouble. I simply use http/ws and add the security headers",
        "createdAt" : "2019-05-22T18:31:19Z",
        "updatedAt" : "2019-05-22T19:16:13Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "3f4aa1da011bf7a2a1d66a406abf4d4cce968633",
    "line" : null,
    "diffHunk" : "@@ -144,5 +144,7 @@ function addSecureHeaders(res :Response, config :any) {\n     res.setHeader(\"X-Frame-Options\", \"sameorigin\")\n     res.setHeader(\"X-XSS-Protection\", \"1; mode=block\")\n     res.setHeader(\"Referrer-Policy\", \"no-referrer-when-downgrade\")\n-    res.setHeader(\"Content-Security-Policy\", `default-src 'self'; connect-src 'self' ws://${config.http.hostname}:${config.http.port}/; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;`)\n+\n+    const host = config.http.port === 80 ? config.http.hostname : `${config.http.hostname}:${config.http.port}`\n+    res.setHeader(\"Content-Security-Policy\", `default-src 'self'; connect-src 'self' wss://${host}/ ws://${host}/; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;`)"
  }
]