[
  {
    "id" : "eed18a91-e73b-4b80-b2da-e22125c8596d",
    "prId" : 711,
    "comments" : [
      {
        "id" : "ebd52f3d-5b56-48e7-8e3a-b280830ff432",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Why `307` rather than `301`, i.e., why a temporary redirect instead of a permanent redirect?",
        "createdAt" : "2019-04-26T07:00:35Z",
        "updatedAt" : "2019-04-30T02:12:29Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "2345814f-0375-4364-9588-121b7cbcbc0b",
        "parentId" : "ebd52f3d-5b56-48e7-8e3a-b280830ff432",
        "author" : {
          "login" : "neil-da",
          "name" : "Neil Mitchell",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/35463327?u=0eb1719958bc6e449ec5e7df3a312fa566f5055d&v=4"
        },
        "body" : "Because we might change our mind in future and don't want browsers to go straight to the new location. A permanent redirect is often a bad idea.",
        "createdAt" : "2019-04-26T07:49:23Z",
        "updatedAt" : "2019-04-30T02:12:29Z",
        "lastEditedBy" : {
          "login" : "neil-da",
          "name" : "Neil Mitchell",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/35463327?u=0eb1719958bc6e449ec5e7df3a312fa566f5055d&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "b071f23b-d251-42f7-8bdf-b43f30c79a10",
        "parentId" : "ebd52f3d-5b56-48e7-8e3a-b280830ff432",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "I agree for redirects to different hosts but for an HTTP -> HTTPS redirect on the same host, `301` seems more appropriate.",
        "createdAt" : "2019-04-26T07:52:33Z",
        "updatedAt" : "2019-04-30T02:12:29Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "cfcd82f1-a488-4084-b031-f6093fa125f4",
        "parentId" : "ebd52f3d-5b56-48e7-8e3a-b280830ff432",
        "author" : {
          "login" : "neil-da",
          "name" : "Neil Mitchell",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/35463327?u=0eb1719958bc6e449ec5e7df3a312fa566f5055d&v=4"
        },
        "body" : "Unconvinced we won't go behind an Nginx style redirector, in which case we'd then ditch having https on this server at all.",
        "createdAt" : "2019-04-26T08:17:31Z",
        "updatedAt" : "2019-04-30T02:12:29Z",
        "lastEditedBy" : {
          "login" : "neil-da",
          "name" : "Neil Mitchell",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/35463327?u=0eb1719958bc6e449ec5e7df3a312fa566f5055d&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "0591f1dd-016b-428d-97b5-da4ce8358f81",
        "parentId" : "ebd52f3d-5b56-48e7-8e3a-b280830ff432",
        "author" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "body" : "I noticed odd behavior in chrome without the temporary. It started redirecting things I didn't want, like other ports on the same host!",
        "createdAt" : "2019-04-26T15:37:53Z",
        "updatedAt" : "2019-04-30T02:12:29Z",
        "lastEditedBy" : {
          "login" : "bolek-wisniewski",
          "name" : "Bolek@DigitalAsset",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/25302921?u=0ebe382413a7e394adf0aa30927d2c94e4882778&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "9a52e14407fd5a139f7bc38ffc947f86b07d20cb",
    "line" : 22,
    "diffHunk" : "@@ -0,0 +1,26 @@\n+// Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+// SPDX-License-Identifier: Apache-2.0\n+\n+import { Application } from \"express\"\n+const conf = require('../config').read()\n+\n+/**\n+ * Due to limitations in our gcp load balancers we implement redirects to https ourselves, on a separate port\n+ */\n+export default class HttpToHttpsRoute {\n+    redirectApp :Application\n+    constructor(redirectApp :Application) {\n+        this.redirectApp = redirectApp\n+    }\n+\n+    init() : HttpToHttpsRoute {\n+        this.redirectApp.get('*', (req,res) => {\n+            if(!req.secure) {\n+                const r = ['https://', req.hostname, \":\", 443, req.url].join('')\n+                return res.redirect(307, r);"
  }
]