[
  {
    "id" : "297de102-b7d7-4718-90db-44fc49783890",
    "prId" : 6516,
    "comments" : [
      {
        "id" : "ec34ff24-bc47-4c7f-b411-f5a572684d87",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Maybe worth factoring out at least the shared parts such as module name, template name and field name into a `where`?",
        "createdAt" : "2020-06-29T08:01:53Z",
        "updatedAt" : "2020-06-30T18:06:09Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "8c9efc7a1908f7441b41b0d2ca49c22490f8c777",
    "line" : 64,
    "diffHunk" : "@@ -16,82 +16,250 @@ import DA.Bazel.Runfiles\n \n mainTest :: IO ()\n mainTest = defaultMain $ testGroup \"DA.Daml.LF.Verify\"\n-  [ quickstartTests,\n-    conditionalTests\n+  [ quickstartTests\n+  , generalTests\n+  , conditionalTests\n+  , recursionTests\n   ]\n \n+quickstartPath :: String\n+quickstartPath = \"compiler/daml-lf-verify/quickstart.dar\"\n+generalPath :: String\n+generalPath = \"compiler/daml-lf-verify/general.dar\"\n+conditionalsPath :: String\n+conditionalsPath = \"compiler/daml-lf-verify/conditionals.dar\"\n+recursionPath :: String\n+recursionPath = \"compiler/daml-lf-verify/recursion.dar\"\n+\n quickstartTests :: TestTree\n quickstartTests = testGroup \"Quickstart\"\n   [ testCase \"Iou_Split\" $ do\n-      quickstartDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/quickstart.dar\")\n-      let tmpl = TypeConName [\"Iou\"]\n+      quickstartDar <- locateRunfiles (mainWorkspace </> quickstartPath)\n+      let mod = ModuleName [\"Iou\"]\n+          tmpl = TypeConName [\"Iou\"]\n           choice = ChoiceName \"Iou_Split\"\n           field = FieldName \"amount\"\n-      result <- verify quickstartDar debug tmpl choice tmpl field\n+      result <- verify quickstartDar debug mod tmpl choice mod tmpl field\n       assertEqual \"Verification failed for Iou_Split - amount\"\n-        Success result\n+        [Success] result\n   , testCase \"Iou_Merge\" $ do\n-      quickstartDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/quickstart.dar\")\n-      let tmpl = TypeConName [\"Iou\"]\n+      quickstartDar <- locateRunfiles (mainWorkspace </> quickstartPath)\n+      let mod = ModuleName [\"Iou\"]\n+          tmpl = TypeConName [\"Iou\"]\n           choice = ChoiceName \"Iou_Merge\"\n           field = FieldName \"amount\"\n-      result <- verify quickstartDar debug tmpl choice tmpl field\n+      result <- verify quickstartDar debug mod tmpl choice mod tmpl field\n       assertEqual \"Verification failed for Iou_Merge - amount\"\n-        Success result\n+        [Success] result\n+  ]\n+\n+generalTests :: TestTree\n+generalTests = testGroup \"General\"\n+  [ testCase \"Success A\" $ do\n+      genDar <- locateRunfiles (mainWorkspace </> generalPath)\n+      let mod = ModuleName [\"General\"]"
  },
  {
    "id" : "25b99966-b1b9-4979-a877-38137a457d8b",
    "prId" : 6516,
    "comments" : [
      {
        "id" : "7d8ee11f-a265-4206-ba68-3df7f24bbb0e",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "For other reviewers: I’ve discussed this with @Gertjan423 and this looked like a very weird and complicated bug so given the limited time (i.e. no time at all) that he has left, we decided to mark it as an expected failure so we can merge this PR.",
        "createdAt" : "2020-06-30T17:45:24Z",
        "updatedAt" : "2020-06-30T18:06:09Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "8c9efc7a1908f7441b41b0d2ca49c22490f8c777",
    "line" : null,
    "diffHunk" : "@@ -16,82 +17,256 @@ import DA.Bazel.Runfiles\n \n mainTest :: IO ()\n mainTest = defaultMain $ testGroup \"DA.Daml.LF.Verify\"\n-  [ quickstartTests,\n-    conditionalTests\n+  [ quickstartTests\n+  , generalTests\n+  , conditionalTests\n+  , recursionTests\n+  , expectFail recursionTestFail"
  },
  {
    "id" : "cc6172c1-8949-4a4d-a700-bf1b9b945b23",
    "prId" : 6101,
    "comments" : [
      {
        "id" : "22dc9577-74e4-4353-ae46-805436d819c4",
        "parentId" : null,
        "author" : {
          "login" : "hurryabit",
          "name" : "Martin Huschenbett",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/11665611?u=7dbd00d5e7ea53919ed31dc4200f602ebca91c8f&v=4"
        },
        "body" : "What's the agreement on when this gets reinstated?",
        "createdAt" : "2020-06-18T17:28:33Z",
        "updatedAt" : "2020-06-18T20:11:15Z",
        "lastEditedBy" : {
          "login" : "hurryabit",
          "name" : "Martin Huschenbett",
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/11665611?u=7dbd00d5e7ea53919ed31dc4200f602ebca91c8f&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "eb8d9763-d3ff-46cb-8bba-e39c85865bce",
        "parentId" : "22dc9577-74e4-4353-ae46-805436d819c4",
        "author" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "body" : "See PR#6431.",
        "createdAt" : "2020-06-19T12:05:09Z",
        "updatedAt" : "2020-06-19T12:05:09Z",
        "lastEditedBy" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "f6e65688b4d24eb95403a47fa037c0377875f13e",
    "line" : 6,
    "diffHunk" : "@@ -16,10 +16,11 @@ import DA.Bazel.Runfiles\n \n mainTest :: IO ()\n mainTest = defaultMain $ testGroup \"DA.Daml.LF.Verify\"\n-  [ quickstartTests\n-  , conditionalTests\n+  [ -- quickstartTests, -- TODO: reinstate"
  },
  {
    "id" : "f7b987f5-25fd-4569-a4fc-83b7b4f48863",
    "prId" : 6101,
    "comments" : [
      {
        "id" : "0ca6197c-3515-4c43-a0ba-2e2d6329b598",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Since I don’t like having my stamp on things I don’t understand: I assume you’ve agreed on this with @hurryabit and @Gertjan423?",
        "createdAt" : "2020-06-18T17:46:40Z",
        "updatedAt" : "2020-06-18T17:46:40Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "47523121-93fa-43f9-8cf7-a494f3d254ca",
        "parentId" : "0ca6197c-3515-4c43-a0ba-2e2d6329b598",
        "author" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "body" : "This is only very temporary. The test fails due to a bug on my part. I'm currently working on understanding and fixing the bug. This should certainly be fixed by the weekend :) ",
        "createdAt" : "2020-06-18T17:55:46Z",
        "updatedAt" : "2020-06-18T17:55:46Z",
        "lastEditedBy" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "00eec4bd-a845-4fe8-a509-af49f9c86846",
        "parentId" : "0ca6197c-3515-4c43-a0ba-2e2d6329b598",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Thanks for confirming!",
        "createdAt" : "2020-06-18T18:12:24Z",
        "updatedAt" : "2020-06-18T18:12:24Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "367bd6d8-c574-4e30-a1ce-48579c665ef7",
        "parentId" : "0ca6197c-3515-4c43-a0ba-2e2d6329b598",
        "author" : {
          "login" : "sofiafaro-da",
          "name" : "Sofia Faro",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/63245722?u=b440e86239cc6cb4a8b4aacdc19fff8f1b61068d&v=4"
        },
        "body" : "Yes, sorry for the surprise. Gertjan & I talked about this and decided it would be best to just disable it temporarily. ",
        "createdAt" : "2020-06-18T18:29:06Z",
        "updatedAt" : "2020-06-18T18:29:06Z",
        "lastEditedBy" : {
          "login" : "sofiafaro-da",
          "name" : "Sofia Faro",
          "avatarUrl" : "https://avatars3.githubusercontent.com/u/63245722?u=b440e86239cc6cb4a8b4aacdc19fff8f1b61068d&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "1cc764ae-4b71-4ece-8705-354e47858cf9",
        "parentId" : "0ca6197c-3515-4c43-a0ba-2e2d6329b598",
        "author" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "body" : "See PR#6431.",
        "createdAt" : "2020-06-19T12:05:21Z",
        "updatedAt" : "2020-06-19T12:05:21Z",
        "lastEditedBy" : {
          "login" : "Gertjan423",
          "name" : "Gert-Jan Bottu",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/5838382?u=b47bd98f384562b45de5cd99b73da4c1aac7aceb&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "f6e65688b4d24eb95403a47fa037c0377875f13e",
    "line" : 6,
    "diffHunk" : "@@ -16,10 +16,11 @@ import DA.Bazel.Runfiles\n \n mainTest :: IO ()\n mainTest = defaultMain $ testGroup \"DA.Daml.LF.Verify\"\n-  [ quickstartTests\n-  , conditionalTests\n+  [ -- quickstartTests, -- TODO: reinstate"
  },
  {
    "id" : "01d9b87e-a686-4097-bb26-73229f6c269d",
    "prId" : 5472,
    "comments" : [
      {
        "id" : "89685cc5-903a-4384-bf3a-64182e192984",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Ar the results not deterministic or why are you not just using `assertEqual` on the full `Fail` expression?",
        "createdAt" : "2020-05-11T09:00:23Z",
        "updatedAt" : "2020-05-19T20:39:29Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "2d7c840ec94d841cd4a9d3f0bd85eabff75e5d3a",
    "line" : 85,
    "diffHunk" : "@@ -0,0 +1,97 @@\n+-- Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+-- SPDX-License-Identifier: Apache-2.0\n+\n+module DA.Daml.LF.Verify.Tests\n+    ( mainTest\n+    ) where\n+\n+import System.FilePath\n+import Test.Tasty\n+import Test.Tasty.HUnit\n+\n+import DA.Daml.LF.Ast.Base\n+import DA.Daml.LF.Verify\n+import DA.Daml.LF.Verify.Solve\n+import DA.Bazel.Runfiles\n+\n+-- TODO: Build the dar files from within bazel, instead of passing them in manually.\n+\n+mainTest :: IO ()\n+mainTest = defaultMain $ testGroup \"DA.Daml.LF.Verify\"\n+  [ quickstartTests\n+  , conditionalTests\n+  ]\n+\n+quickstartTests :: TestTree\n+quickstartTests = testGroup \"Quickstart\"\n+  [ testCase \"Iou_Split\" $ do\n+      quickstartDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/quickstart.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"Iou_Split\"\n+          field = FieldName \"amount\"\n+      result <- verify quickstartDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for Iou_Split - amount\"\n+        Success result\n+  , testCase \"Iou_Merge\" $ do\n+      quickstartDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/quickstart.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"Iou_Merge\"\n+          field = FieldName \"amount\"\n+      result <- verify quickstartDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for Iou_Merge - amount\"\n+        Success result\n+  ]\n+\n+conditionalTests :: TestTree\n+conditionalTests = testGroup \"Conditionals\"\n+  [ testCase \"Success A\" $ do\n+      condDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/conditionals.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"SuccA\"\n+          field = FieldName \"content\"\n+      result <- verify condDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for SuccA - content\"\n+        Success result\n+  , testCase \"Success B\" $ do\n+      condDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/conditionals.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"SuccB\"\n+          field = FieldName \"content\"\n+      result <- verify condDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for SuccB - content\"\n+        Success result\n+  , testCase \"Success C\" $ do\n+      condDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/conditionals.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"SuccC\"\n+          field = FieldName \"content\"\n+      result <- verify condDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for SuccC - content\"\n+        Success result\n+  , testCase \"Success D\" $ do\n+      condDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/conditionals.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"SuccD\"\n+          field = FieldName \"content\"\n+      result <- verify condDar False tmpl choice tmpl field\n+      assertEqual \"Verification failed for SuccD - content\"\n+        Success result\n+  , testCase \"Fail A\" $ do\n+      condDar <- locateRunfiles (mainWorkspace </> \"compiler/daml-lf-verify/data/conditionals.dar\")\n+      let tmpl = TypeConName [\"Iou\"]\n+          choice = ChoiceName \"FailA\"\n+          field = FieldName \"content\"\n+      verify condDar False tmpl choice tmpl field >>= \\case\n+        Success -> assertFailure \"Verification wrongfully passed for FailA - content\"\n+        Unknown -> assertFailure \"Verification inconclusive for FailA - content\"\n+        Fail _ -> return ()"
  }
]