[
  {
    "id" : "fe65cba3-ac60-491c-b6eb-af2d058af2aa",
    "prId" : 6467,
    "comments" : [
      {
        "id" : "36bb3996-d8fb-4bf6-a2cc-d84115424b6c",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Can we enable this and add an expected diagnostics to make sure we only hit it in the one places we expect?",
        "createdAt" : "2020-06-23T15:40:54Z",
        "updatedAt" : "2020-06-23T15:41:01Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "b885f56b-66f1-4a48-a2e4-c36fccaf0494",
        "parentId" : "36bb3996-d8fb-4bf6-a2cc-d84115424b6c",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "Ok, let's see how that plays out!",
        "createdAt" : "2020-06-23T15:41:46Z",
        "updatedAt" : "2020-06-23T15:41:46Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "0fcf7a30-fea9-4773-b487-a92b6f9afe6f",
        "parentId" : "36bb3996-d8fb-4bf6-a2cc-d84115424b6c",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "It's kind of a pain. As phrased we'll have to put in 48 `@WARN` lines. I think it hinders rather than helps. You ok with leaving it as is?",
        "createdAt" : "2020-06-23T15:50:26Z",
        "updatedAt" : "2020-06-23T15:50:26Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "cd9f5c3a-be6b-45d6-bf87-d0523c92533a",
        "parentId" : "36bb3996-d8fb-4bf6-a2cc-d84115424b6c",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Yeah if it’s that much definitely leave it out for now.",
        "createdAt" : "2020-06-23T15:59:41Z",
        "updatedAt" : "2020-06-23T15:59:44Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "023d20a2-0fd6-462c-944e-3f408b9c0f75",
        "parentId" : "36bb3996-d8fb-4bf6-a2cc-d84115424b6c",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "Gracias muchos.",
        "createdAt" : "2020-06-23T16:00:31Z",
        "updatedAt" : "2020-06-23T16:00:31Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "567deb06e19c8c134cfcd488ee6df7d410b0a1ba",
    "line" : 14,
    "diffHunk" : "@@ -1,13 +1,20 @@\n -- Copyright (c) 2020, Digital Asset (Switzerland) GmbH and/or its\n -- affiliates. All rights reserved.\n \n--- @WARN range=12:2-12:3; Defined but not used\n+-- @WARN range=19:2-19:3; Defined but not used\n \n {-# OPTIONS_GHC -Wunused-matches #-}\n+{-# OPTIONS_GHC -Wunused-foralls #-}\n+{-# OPTIONS_GHC -Wunused-imports #-}\n+{-# OPTIONS_GHC -Wunused-pattern-binds #-}\n+{-# OPTIONS_GHC -Wunused-top-binds #-}\n+{-# OPTIONS_GHC -Wunused-type-patterns #-}\n+-- We know this will fail and why.\n+--   {-# OPTIONS_GHC -Wunused-local-binds #-}"
  },
  {
    "id" : "f2631715-b72f-4917-8571-e23697d0ce76",
    "prId" : 6423,
    "comments" : [
      {
        "id" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "I might be missing something here but I thought your implementation will not try to silence the unused binds here (which I think is totally reasonable, I’ve never seen anyone write this in DAML) so how does CI pass?",
        "createdAt" : "2020-06-19T18:10:20Z",
        "updatedAt" : "2020-06-19T18:12:51Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "522cf597-16b7-4216-a329-5df9fe7e06f2",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "Those are regular let bindings. They end up in the where clause of an implicit function e.g.\r\n```haskell\r\n  signatory this =\r\n    ...\r\n    where (a, b) = (0, 1)\r\n```\r\nFor some reason, GHC doesn't care about them (!) as evidenced by this program:\r\n```haskell\r\n{-# OPTIONS_GHC -Wunused-matches #-}\r\n\r\nf x = 23\r\n  where (a, b) = (0, 1)\r\n\r\nmain = undefined\r\n```\r\n\r\n```\r\n/Users/shaynefletcher/Foo.hs:3:3: warning: [-Wunused-matches]\r\n    Defined but not used: ‘x’\r\n  |\r\n3 | f x = 23\r\n  |   ^\r\n```\r\n",
        "createdAt" : "2020-06-19T18:17:10Z",
        "updatedAt" : "2020-06-19T18:17:47Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "b87ab1f1-e772-4d39-90c3-f8efcb16d8c2",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "That's not new by the way - we didn't write (any new) code that processes let bindings, only arguments like `this`, `self` and `arg` are getting the \"dummy binding\" treatment.",
        "createdAt" : "2020-06-19T18:18:33Z",
        "updatedAt" : "2020-06-19T18:18:59Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "cdddc05a-c86d-45cf-9b60-161f873be63a",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Oh I see, you didn’t enable `-Wunused-local-binds`. I would suggest to just go for `-Wall` and selectively disable stuff so we capture all the unused stuff GHC has to offer.",
        "createdAt" : "2020-06-19T18:19:24Z",
        "updatedAt" : "2020-06-19T18:19:39Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "94b9a2e0-cdb0-4fcc-b9f8-98d98644f5ac",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "> That's not new by the way - we didn't write (any new) code that processes let bindings, only arguments like `this`, `self` and `arg` are getting the \"dummy binding\" treatment.\r\n\r\nOh I thought let bindings worked if they are variables or as-pattern? If not, we should make them work.",
        "createdAt" : "2020-06-19T18:20:21Z",
        "updatedAt" : "2020-06-19T18:20:21Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "3bc5bbc7-fd08-43a0-9c25-16011ddc8895",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "We pass all arguments to `signatory` and friends to the `dummyBinds` function so all as patterns and var patterns are given that treatment. Bindings in a template `let` block are not \"function parameters\" and are not given any new treatments. Are you suggesting we should be doing more?",
        "createdAt" : "2020-06-19T18:23:47Z",
        "updatedAt" : "2020-06-19T18:23:47Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "b797e6ab-3f79-4085-bb4e-d240b3bc6d67",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "> Oh I see, you didn’t enable `-Wunused-local-binds`\r\n\r\nRight, only `unused-matches`.\r\n\r\n> I would suggest to just go for `-Wall` and selectively disable stuff so we capture all the unused stuff GHC has to offer.\r\n\r\nI don't disagree but you're not arguing to extend the scope of this PR are you?\r\n",
        "createdAt" : "2020-06-19T18:25:10Z",
        "updatedAt" : "2020-06-19T18:25:11Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "128e723f-e88d-4abe-8abb-4bbfdc74c4a0",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "> I don't disagree but you're not arguing to extend the scope of this PR are you?\r\n\r\nI’m not suggesting to change what we do but I am suggesting to enable more warnings so we have an overview of which ones are solved now and which ones are still pending.",
        "createdAt" : "2020-06-19T18:26:24Z",
        "updatedAt" : "2020-06-19T18:26:24Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "90835f81-cdcd-45c2-b641-073c5b5dbb67",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "> > Oh I see, you didn’t enable `-Wunused-local-binds`\r\n> \r\n> Right, only `unused-matches`.\r\n> \r\nIndeed with `unused-local-binds` we get the expected warnings on `a, b`.",
        "createdAt" : "2020-06-19T18:27:10Z",
        "updatedAt" : "2020-06-19T18:27:10Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "7b2d97a0-aac1-40c4-a192-cfd5a053bdee",
        "parentId" : "1b3a9932-cfec-43bf-b669-9433f287d7f0",
        "author" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "body" : "> > I don't disagree but you're not arguing to extend the scope of this PR are you?\r\n> \r\n> I’m not suggesting to change what we do but I am suggesting to enable more warnings so we have an overview of which ones are solved now and which ones are still pending.\r\n\r\nSounds good. Yep more to do.",
        "createdAt" : "2020-06-19T18:35:54Z",
        "updatedAt" : "2020-06-19T18:35:54Z",
        "lastEditedBy" : {
          "login" : "shayne-fletcher",
          "name" : "Shayne Fletcher",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/1500167?v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "8d1d4fdf697ac5c029167f8d8e4fd28d3f308c8f",
    "line" : 21,
    "diffHunk" : "@@ -0,0 +1,36 @@\n+-- Copyright (c) 2020, Digital Asset (Switzerland) GmbH and/or its\n+-- affiliates. All rights reserved.\n+\n+-- @WARN range=12:2-12:3; Defined but not used\n+\n+{-# OPTIONS_GHC -Wunused-matches #-}\n+module UnusedMatchTests where\n+\n+-- It should be OK to enable -Wunused-matches and not get warnings\n+-- from template desugared code.\n+\n+f x = 12 -- Defined but not used 'x'; prove unsed match detection.\n+\n+template T\n+  with\n+    p : Party\n+    q : Party\n+  where\n+    -- Include interaction with local binds.\n+    let revokeRetVal = ()\n+        (sig, obs) = (p, q)"
  }
]