[
  {
    "id" : "99bb411f-cf39-4bcd-8c86-595bb5f2a7a8",
    "prId" : 6829,
    "comments" : [
      {
        "id" : "233e2ef7-e207-46c3-8c22-1c5e51116a36",
        "parentId" : null,
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "Maybe `-participant` is redundant? In the logs it should anyway be logged as key-value pair.",
        "createdAt" : "2020-07-22T11:49:38Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "b2c425aa-8fe4-4952-8be0-e0c51495cece",
        "parentId" : "233e2ef7-e207-46c3-8c22-1c5e51116a36",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Happy to change it to simply `\"daml-on-sql\"`.",
        "createdAt" : "2020-07-22T12:31:56Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "4c76c6fa-8788-4eb8-8b87-9e5553d44655",
        "parentId" : "233e2ef7-e207-46c3-8c22-1c5e51116a36",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Done.",
        "createdAt" : "2020-07-22T12:44:54Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "3ae9f85131fa95cfb3411a293e424bd306921d82",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,47 @@\n+// Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package com.daml.on.sql\n+\n+import com.daml.ledger.participant.state.v1\n+import com.daml.ledger.participant.state.v1.SeedService.Seeding\n+import com.daml.platform.configuration.{InvalidConfigException, LedgerConfiguration}\n+import com.daml.platform.sandbox.cli.Cli\n+import com.daml.platform.sandbox.config.{LedgerName, SandboxConfig}\n+import com.daml.platform.sandbox.{GlobalLogLevel, SandboxServer}\n+import com.daml.resources.ProgramResource\n+\n+object Main {\n+\n+  private val Name = LedgerName(\"DAML-on-SQL\")\n+\n+  private[sql] val defaultConfig: SandboxConfig =\n+    SandboxConfig.defaultConfig.copy(\n+      participantId = v1.ParticipantId.assertFromString(\"daml-on-sql-participant\"),"
  },
  {
    "id" : "9834ff50-ace5-47c2-bf06-4f5934b78e8f",
    "prId" : 6829,
    "comments" : [
      {
        "id" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "parentId" : null,
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "Ideally we could make the `--ledgerid` parameter required for daml-on-sql. Maybe pass that in as a parameter to `Cli`?",
        "createdAt" : "2020-07-22T11:57:05Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "349efcfa-4d67-446d-9ed9-186879bc1094",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "We can check if it's set in `Main` right below here. Perhaps that'd be easier to understand.\r\n\r\nTBH I am not a fan of making `--switch`-style switches mandatory, but we can't really do otherwise without changing the API.",
        "createdAt" : "2020-07-22T12:31:21Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "8c8dfced-8734-47cd-941e-8ed7f7d6c503",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Done.",
        "createdAt" : "2020-07-22T12:45:02Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "96d1b6cd-e838-421f-a1ca-8730bf7beae4",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "What do you think about removing all post-config checks from `Main` and rather parametrizing `Cli` accordingly, e.g. make `--sql-backend-jdbcurl` required, remove (or hide) `--implicit-party-allocation`, etc... ?",
        "createdAt" : "2020-07-22T12:46:40Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "f42374ab-b78a-4667-8aa3-226c31440e28",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "TBH I think it would hide the logic custom to the DAML-on-SQL product. Putting a bunch of `if` checks in `Cli` seems to me to be the wrong place for the responsibility.\r\n\r\nI pulled out a separate Bazel package and main class for DAML-on-SQL so that I could avoid a bunch of `if` checks scattered around the code. By adding the package and putting all custom behavior in the main function, there's only one `if`, and it's in the user's brain when they choose which ledger implementation to run.",
        "createdAt" : "2020-07-22T13:44:07Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "31f17d21-343d-4cac-8a94-a33420228f2c",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Hmmm, thinking about this again, you're right that the `Cli` is better-placed to yield more useful error messages for less code. I'll try it and see how it goes.",
        "createdAt" : "2020-07-22T14:13:46Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "e86cfd21-1896-40f0-91e3-57f0bced1575",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Opened https://github.com/digital-asset/daml/pull/6846 as an attempt. I don't really like it but I can't see a much better approach IMO.\r\n\r\nMost of the additions are extra tests.",
        "createdAt" : "2020-07-23T15:50:39Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "db1d64bd-c543-45b1-b39f-729dd8da59db",
        "parentId" : "4f134edd-1946-4781-b821-91adbaa0f9f3",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Merged #6846 into this one. Can I get a review please?",
        "createdAt" : "2020-07-24T08:03:12Z",
        "updatedAt" : "2020-07-24T16:31:57Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "3ae9f85131fa95cfb3411a293e424bd306921d82",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,47 @@\n+// Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package com.daml.on.sql\n+\n+import com.daml.ledger.participant.state.v1\n+import com.daml.ledger.participant.state.v1.SeedService.Seeding\n+import com.daml.platform.configuration.{InvalidConfigException, LedgerConfiguration}\n+import com.daml.platform.sandbox.cli.Cli\n+import com.daml.platform.sandbox.config.{LedgerName, SandboxConfig}\n+import com.daml.platform.sandbox.{GlobalLogLevel, SandboxServer}\n+import com.daml.resources.ProgramResource\n+\n+object Main {\n+\n+  private val Name = LedgerName(\"DAML-on-SQL\")\n+\n+  private[sql] val defaultConfig: SandboxConfig ="
  }
]