[
  {
    "id" : "0d8c4e7e-4f42-493f-a5bb-819853e5a074",
    "prId" : 2799,
    "comments" : [
      {
        "id" : "f8a43eb6-e1aa-4d52-b40e-a8f97fc9ebe1",
        "parentId" : null,
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "When should I expect this to return `None`? The docs in the proto state that the offset is required so I’m not sure when it is empty.",
        "createdAt" : "2019-09-06T16:04:52Z",
        "updatedAt" : "2019-09-18T07:19:07Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "06e474e7-14d6-4ce7-ada8-90da79f95418",
        "parentId" : "f8a43eb6-e1aa-4d52-b40e-a8f97fc9ebe1",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "The materialized value will be None if the stream terminates with an error. Alternatively we could also fail the materialized future.",
        "createdAt" : "2019-09-06T16:19:27Z",
        "updatedAt" : "2019-09-18T07:19:07Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "ca9857ff-045a-438b-bb3c-ed677111e137",
        "parentId" : "f8a43eb6-e1aa-4d52-b40e-a8f97fc9ebe1",
        "author" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "body" : "Failing seems more intuitive to me but I’m happy to leave this decision to you. It would however be nice to have a comment on `getActiveContracts` that explains this.",
        "createdAt" : "2019-09-06T16:23:33Z",
        "updatedAt" : "2019-09-18T07:19:07Z",
        "lastEditedBy" : {
          "login" : "cocreature",
          "name" : "Moritz Kiefer",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/1313584?u=7864421488a876940b33e865c4b0091925617ca7&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "301b2ed2-dfe5-493b-847c-553520c3148f",
        "parentId" : "f8a43eb6-e1aa-4d52-b40e-a8f97fc9ebe1",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "Thanks for the input, @cocreature. I went back to failing the materialized future.",
        "createdAt" : "2019-09-09T07:23:58Z",
        "updatedAt" : "2019-09-18T07:19:07Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "5f4d250cb9d073f6b74c10fe07df62001768087b",
    "line" : null,
    "diffHunk" : "@@ -21,10 +21,11 @@ object ActiveContractSetSource {\n   def apply(\n       stub: (GetActiveContractsRequest, StreamObserver[GetActiveContractsResponse]) => Unit,\n       request: GetActiveContractsRequest)(implicit esf: ExecutionSequencerFactory)\n-    : Source[GetActiveContractsResponse, Future[String]] = {\n+    : Source[GetActiveContractsResponse, Future[Option[String]]] = {\n \n     ClientAdapter\n       .serverStreaming(request, stub)\n-      .viaMat(new ExtractMaterializedValue(r => Some(r.offset)))(Keep.right)\n+      .viaMat(new ExtractLastMaterializedValue(r =>\n+        if (r.offset.nonEmpty) Some(r.offset) else None))(Keep.right)"
  }
]