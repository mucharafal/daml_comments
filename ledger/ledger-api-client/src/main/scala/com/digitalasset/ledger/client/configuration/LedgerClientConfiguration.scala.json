[
  {
    "id" : "b0cbcd6f-80fd-4be9-b042-fe4c5c8058fe",
    "prId" : 6807,
    "comments" : [
      {
        "id" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Seems a bit high, do we really want to allow dumps so large? I think that the built-in limit is fine, as the dump is intended mostly for debugging purposes when developing small things. For larger dumps the process of inspecting the textual dump likely makes little sense.",
        "createdAt" : "2020-07-21T12:21:32Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "b160be26-9e4f-42d9-90fe-281029cdc4d6",
        "parentId" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "DO you think we should leave it to 8 KB then, and just truncate?",
        "createdAt" : "2020-07-21T12:30:54Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "304f67e2-c2f0-4da1-b982-45173b95094b",
        "parentId" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "I think 8KB is fine. At that point, the dump is already basically unreadable and there should exist some other way of dealing with it.",
        "createdAt" : "2020-07-21T12:37:17Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "53964024-adac-4fa6-b59b-39bf45957b47",
        "parentId" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "author" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "body" : "yeah, I think the error message should describe the error well. We can log the full transaction in DEBUG mode on the server side.\r\nDepending on where the response header limit error is thrown, maybe we can install a generic interceptor that does the truncation at a safe length (a few hundred chars should be enough). This is to ensure that the user always gets to see the real error. ",
        "createdAt" : "2020-07-21T12:39:56Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "gerolf-da",
          "name" : "Gerolf Seitz",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/29121423?u=f683aa614e742c653ae8c01b194905dcdef6e974&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "17a80b0b-32a0-4cc5-8efd-3ff126ec346a",
        "parentId" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "That's exactly what the [`TruncatedStatusInterceptor`](https://github.com/digital-asset/daml/pull/6807/files#diff-969b0fe6e367db5e9d13cc1601f181d8) does. ðŸ™‚ ",
        "createdAt" : "2020-07-21T12:42:41Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "77452bb3-f958-481e-ba27-5343874e3ab0",
        "parentId" : "76c2fb95-6655-4dd0-ad21-20209c81c763",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Reduced back to 8 KB (the default), and error messages are now truncated to 4 KB.",
        "createdAt" : "2020-07-21T13:33:15Z",
        "updatedAt" : "2020-07-21T14:03:15Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "88c44b408b84304c6c351cb63fbcd5c5a400375d",
    "line" : null,
    "diffHunk" : "@@ -3,18 +3,32 @@\n \n package com.daml.ledger.client.configuration\n \n+import com.daml.ledger.client.configuration.LedgerClientConfiguration._\n import io.netty.handler.ssl.SslContext\n \n /**\n-  * @param applicationId The string that will be used as an application identifier when issuing commands and retrieving transactions\n-  * @param ledgerIdRequirement A [[LedgerIdRequirement]] specifying how the ledger identifier must be checked against the one returned by the LedgerIdentityService\n-  * @param commandClient The [[CommandClientConfiguration]] that defines how the command client should be setup with regards to timeouts, commands in flight and command TTL\n-  * @param sslContext If defined, the context will be passed on to the underlying gRPC code to ensure the communication channel is secured by TLS\n-  * @param token If defined, the access token that will be passed by default, unless overridden in individual calls (mostly useful for short-lived applications)\n+  * @param applicationId         The string that will be used as an application identifier when issuing commands and retrieving transactions\n+  * @param ledgerIdRequirement   A [[LedgerIdRequirement]] specifying how the ledger identifier must be checked against the one returned by the LedgerIdentityService\n+  * @param commandClient         The [[CommandClientConfiguration]] that defines how the command client should be setup with regards to timeouts, commands in flight and command TTL\n+  * @param sslContext            If defined, the context will be passed on to the underlying gRPC code to ensure the communication channel is secured by TLS\n+  * @param token                 If defined, the access token that will be passed by default, unless overridden in individual calls (mostly useful for short-lived applications)\n+  * @param maxInboundMessageSize The maximum size of the response headers.\n   */\n final case class LedgerClientConfiguration(\n     applicationId: String,\n     ledgerIdRequirement: LedgerIdRequirement,\n     commandClient: CommandClientConfiguration,\n     sslContext: Option[SslContext],\n-    token: Option[String] = None)\n+    token: Option[String] = None,\n+    maxInboundMessageSize: Int = DefaultMaxInboundMessageSize,\n+)\n+\n+object LedgerClientConfiguration {\n+\n+  // This needs to be large because we often include parts of the request in GRPC errors, which are\n+  // returned in the response headers. A large request could lead to the client choking on the\n+  // response headers if the limit is too low.\n+  // The default limit set by Netty is 8 KB, which often leads to errors.\n+  val DefaultMaxInboundMessageSize: Int = 1024 * 1024 // 1 MB"
  },
  {
    "id" : "0a868c99-5423-40fb-8b56-dfdc8bfa959c",
    "prId" : 3138,
    "comments" : [
      {
        "id" : "bb45b32f-e307-4911-8766-57ec37d8b6c1",
        "parentId" : null,
        "author" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "body" : "Similar here, describe what `accessToken` is.",
        "createdAt" : "2019-10-18T08:50:24Z",
        "updatedAt" : "2019-10-18T13:12:04Z",
        "lastEditedBy" : {
          "login" : "rautenrieth-da",
          "name" : "Robert Autenrieth",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/31539813?u=e5fe17e2c6f986e9ee04c5b9ca5f6a5a90d1c94a&v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "4b71b146-baea-4305-8a6e-51275e9df43f",
        "parentId" : "bb45b32f-e307-4911-8766-57ec37d8b6c1",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Addressed by https://github.com/digital-asset/daml/pull/3138/commits/036f8bea1a07eedc4fe4c365c27d1c062e8d4910",
        "createdAt" : "2019-10-18T11:50:48Z",
        "updatedAt" : "2019-10-18T13:12:04Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "bb3817c9a66c72de085b1959aae0ac7ddc5f7a3d",
    "line" : 17,
    "diffHunk" : "@@ -9,4 +9,5 @@ final case class LedgerClientConfiguration(\n     applicationId: String,\n     ledgerIdRequirement: LedgerIdRequirement,\n     commandClient: CommandClientConfiguration,\n-    sslContext: Option[SslContext])\n+    sslContext: Option[SslContext],\n+    accessToken: Option[String] = None)"
  }
]