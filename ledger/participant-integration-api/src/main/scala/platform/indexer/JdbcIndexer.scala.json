[
  {
    "id" : "e5d45d73-7b2f-4e23-9e36-ab6ecef7df5e",
    "prId" : 7678,
    "comments" : [
      {
        "id" : "7de3bbe4-cf3e-458e-bbc8-ddd77256e718",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Please rename this as well.",
        "createdAt" : "2020-10-14T12:12:46Z",
        "updatedAt" : "2020-10-19T09:32:37Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "674bae11cc5a88ac1ab207b4a337c1c39eb07a5a",
    "line" : null,
    "diffHunk" : "@@ -211,7 +207,7 @@ object JdbcIndexer {\n     }\n \n   private def contextFor(offset: Offset, update: Update): Map[String, String] ="
  },
  {
    "id" : "b90d700b-25d5-4837-a3b1-cbc676351967",
    "prId" : 7678,
    "comments" : [
      {
        "id" : "04784454-0f59-4228-9cd1-3b499f44058d",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "There's inconsistency in how you name your implicit resource contexts. I would recommend sticking to the naming you used here (`resourceContext`), since we also have other contexts we pass around.",
        "createdAt" : "2020-10-14T12:13:16Z",
        "updatedAt" : "2020-10-19T09:32:37Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
        ]
      },
      {
        "id" : "86c33b3d-c2e9-40ca-b7a7-6908c577db12",
        "parentId" : "04784454-0f59-4228-9cd1-3b499f44058d",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "I tried to keep it as `resourceContext` except when it's the implicit parameter of a `ResourceOwner#acquire`, in which case it's `context`. Is this too confusing?",
        "createdAt" : "2020-10-14T12:36:11Z",
        "updatedAt" : "2020-10-19T09:32:37Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "674bae11cc5a88ac1ab207b4a337c1c39eb07a5a",
    "line" : 109,
    "diffHunk" : "@@ -120,9 +116,9 @@ object JdbcIndexer {\n       ledgerDao.initializeLedger(providedLedgerId)\n     }\n \n-    private def initOrCheckParticipantId(dao: LedgerDao)(\n-        implicit executionContext: ExecutionContext,\n-    ): Future[Unit] = {\n+    private def initOrCheckParticipantId(\n+        dao: LedgerDao,\n+    )(implicit resourceContext: ResourceContext): Future[Unit] = {"
  },
  {
    "id" : "2f859b0f-288e-4f1b-bfc7-290db2d72918",
    "prId" : 7035,
    "comments" : [
      {
        "id" : "212dd52b-f345-4d20-a37b-d07678a92dc2",
        "parentId" : null,
        "author" : {
          "login" : "S11001001",
          "name" : "Stephen Compall",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/219186?u=7b27ed58a578fe7d4983d1bab28c2f5608ed8739&v=4"
        },
        "body" : "Same considerations in play as in https://github.com/digital-asset/daml/pull/6992/files#r465275865",
        "createdAt" : "2020-08-05T20:25:14Z",
        "updatedAt" : "2020-08-06T16:33:01Z",
        "lastEditedBy" : {
          "login" : "S11001001",
          "name" : "Stephen Compall",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/219186?u=7b27ed58a578fe7d4983d1bab28c2f5608ed8739&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "deb19bec-6300-4b10-81be-68fe59ccce16",
        "parentId" : "212dd52b-f345-4d20-a37b-d07678a92dc2",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "This looks like a bug. The logging context should be passed through to `handleStateUpdate`. Instead it's using one that's passed in at the class constructor level. I'll open a separate fix.",
        "createdAt" : "2020-08-06T08:14:45Z",
        "updatedAt" : "2020-08-06T16:33:01Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "1bd03931-41df-433f-a8e7-156aa9c2140a",
        "parentId" : "212dd52b-f345-4d20-a37b-d07678a92dc2",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Fixed in #7042. Please take a look when you can.",
        "createdAt" : "2020-08-06T08:49:57Z",
        "updatedAt" : "2020-08-06T16:33:01Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "0726e49f-7285-4931-9b01-8cb34275c177",
        "parentId" : "212dd52b-f345-4d20-a37b-d07678a92dc2",
        "author" : {
          "login" : "S11001001",
          "name" : "Stephen Compall",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/219186?u=7b27ed58a578fe7d4983d1bab28c2f5608ed8739&v=4"
        },
        "body" : "Included in this PR's build.",
        "createdAt" : "2020-08-06T16:32:37Z",
        "updatedAt" : "2020-08-06T16:33:01Z",
        "lastEditedBy" : {
          "login" : "S11001001",
          "name" : "Stephen Compall",
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/219186?u=7b27ed58a578fe7d4983d1bab28c2f5608ed8739&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "30cbc3d8e9f4cacb010da04e800f24c665c6c3e5",
    "line" : null,
    "diffHunk" : "@@ -360,13 +360,12 @@ private[indexer] class JdbcIndexer private[indexer] (\n           .viaMat(KillSwitches.single)(Keep.right[NotUsed, UniqueKillSwitch])\n           .mapAsync(1) {\n             case (offset, update) =>\n-              withEnrichedLoggingContext(JdbcIndexer.contextFor(offset, update)) {\n-                implicit loggingContext =>\n-                  Timed\n-                    .future(\n-                      metrics.daml.indexer.stateUpdateProcessing,\n-                      handleStateUpdate(offset, update),\n-                    )\n+              withEnrichedLoggingContext(JdbcIndexer.contextFor(offset, update)) { _ =>\n+                Timed\n+                  .future(\n+                    metrics.daml.indexer.stateUpdateProcessing,\n+                    handleStateUpdate(offset, update),\n+                  )"
  },
  {
    "id" : "42fc3d32-2673-435f-bb64-90fc9aedf129",
    "prId" : 6924,
    "comments" : [
      {
        "id" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "parentId" : null,
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "Seems like that class name could also go into the context.",
        "createdAt" : "2020-07-31T09:44:04Z",
        "updatedAt" : "2020-07-31T11:58:54Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "93121f9a-af22-4d91-b6d7-3237070424f6",
        "parentId" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "I'm a bit hesitant on this one. It uses reflection, which can be quite a hit. And while `trace` makes sure the the string interpolation is evaluated lazily, the context creation is not, which is probably something we should fix. Still, it's probably not an actual bottleneck, so I'll gladly add it to the context and open a ticket to track this conversation.",
        "createdAt" : "2020-07-31T10:06:08Z",
        "updatedAt" : "2020-07-31T11:58:54Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "d032604b-390f-44bf-a050-c19e9c07a3c8",
        "parentId" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Even better, every `Update` has a description, I'll use that as a message. Still, I think it would be relevant to see if it could make sense to make context construction lazy.",
        "createdAt" : "2020-07-31T11:17:30Z",
        "updatedAt" : "2020-07-31T11:58:54Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "dccd2dbe-d2c3-43f2-8ee7-ae93b1601c55",
        "parentId" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "author" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "body" : "That makes sense!",
        "createdAt" : "2020-07-31T11:39:32Z",
        "updatedAt" : "2020-07-31T11:58:54Z",
        "lastEditedBy" : {
          "login" : "SamirTalwar-DA",
          "name" : "Samir Talwar",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/60356447?u=f6cdfccc6ea4254bd7c212099bbac2c27a00a28c&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "177c9624-baea-4370-824b-a34a8d4ba99b",
        "parentId" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Addressed by https://github.com/digital-asset/daml/pull/6924/commits/c15aed4bb7897d36f227a71b2d372e9670750bf4",
        "createdAt" : "2020-07-31T12:03:43Z",
        "updatedAt" : "2020-07-31T12:03:43Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "c676830e-b860-4b00-94ff-e9136280e578",
        "parentId" : "d019aeba-c216-40ca-bdf9-b0e459094f95",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Opened https://github.com/digital-asset/daml/issues/6944",
        "createdAt" : "2020-07-31T12:15:58Z",
        "updatedAt" : "2020-07-31T12:15:58Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "865574590cb0a7ba8a61b4b5c4f66bdee74d6153",
    "line" : null,
    "diffHunk" : "@@ -133,6 +232,8 @@ private[indexer] class JdbcIndexer private[indexer] (\n   private def handleStateUpdate(offset: Offset, update: Update): Future[Unit] = {\n     lastReceivedRecordTime = update.recordTime.toInstant.toEpochMilli\n \n+    logger.trace(s\"Update (${update.getClass.getSimpleName})\")"
  }
]