[
  {
    "id" : "bf72dbe8-1cf3-4669-b8ea-86d36274cc98",
    "prId" : 6372,
    "comments" : [
      {
        "id" : "18a45176-3920-41cc-b8c0-223719bc96db",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "How did you check for this? Consider that H2 index naming is less predictable than Postgres'.",
        "createdAt" : "2020-06-26T06:59:30Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "052a87f6-a6be-4a57-b27f-b48132a1c1c5",
        "parentId" : "18a45176-3920-41cc-b8c0-223719bc96db",
        "author" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "body" : "yeah my bad, I added the name to the index and dropping it by name now. Or should I just remove it from the original script? Why do we even bother supporting flyway migration scripts for H2?",
        "createdAt" : "2020-06-26T22:22:55Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "82192912-3507-48ed-88db-2301db3c34d9",
        "parentId" : "18a45176-3920-41cc-b8c0-223719bc96db",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "We are using schema migration only, but indeed it may be the case that it could make more sense to simply keep a squashed schema. This could be part of the Sandbox/DAML-on-SQL split.",
        "createdAt" : "2020-06-29T07:26:07Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "e1c066dc-c569-40af-ba85-b3ee9ecd95b9",
        "parentId" : "18a45176-3920-41cc-b8c0-223719bc96db",
        "author" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "body" : "ok... in any case, I will not be squashing it as part of this PR.",
        "createdAt" : "2020-06-29T14:14:05Z",
        "updatedAt" : "2020-07-07T20:49:51Z",
        "lastEditedBy" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a4ac22ba1dbfc5a1f114a75812abec7b87d0eb34",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,23 @@\n+-- Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+-- SPDX-License-Identifier: Apache-2.0\n+\n+---------------------------------------------------------------------------------------------------\n+-- V34: Add a sequential row_id to participant_events\n+--\n+---------------------------------------------------------------------------------------------------\n+\n+-- 1. add the column\n+alter table participant_events add column row_id bigint auto_increment;\n+\n+\n+-- 2. fix the row_id to be sequential according to the order of (event_offset, transaction_id, node_index)\n+-- don't need to migrate H2 datasets\n+\n+-- 3. drop the now unused index\n+-- looks like we never created this index in H2"
  },
  {
    "id" : "05ed55ac-951e-4163-9d23-43f02ceb172f",
    "prId" : 6372,
    "comments" : [
      {
        "id" : "0ff6ea25-32ae-4736-913d-b09d1a1a52a2",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "I would suggest naming this so that's it's clear it's supposed to be sequential, in particular with regards to the history. What about `event_sequential_id`?",
        "createdAt" : "2020-06-26T14:03:14Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "a2b7ef6f-e7da-4011-b36b-af8bb238b022",
        "parentId" : "0ff6ea25-32ae-4736-913d-b09d1a1a52a2",
        "author" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "body" : "It is `participant_events` table I don't think we need to say `event_` one more time, `row_id` has `auto_increment` type, which is self descriptive. However if you insist on calling it `event_sequential_id` I guess it would make it consistent with `event_id` and `event_offset`. Up to you.",
        "createdAt" : "2020-06-26T21:54:49Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "32fda69a-90bf-4c78-86c0-c253dccd18b0",
        "parentId" : "0ff6ea25-32ae-4736-913d-b09d1a1a52a2",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "I understand it's part of the type and that it can feel as if it's repeating unnecessary information, but I would prefer if its purpose could be clearer from the name, without having to go to the definition. `row_id` feels a bit too generic. I would prefer having a more telling name.",
        "createdAt" : "2020-06-29T07:33:06Z",
        "updatedAt" : "2020-07-07T20:49:50Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "7cf5f548-4c36-4aff-a7a3-85da12f353e9",
        "parentId" : "0ff6ea25-32ae-4736-913d-b09d1a1a52a2",
        "author" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "body" : "all right, I will rename the column to `event_sequential_id`",
        "createdAt" : "2020-06-29T14:14:53Z",
        "updatedAt" : "2020-07-07T20:49:51Z",
        "lastEditedBy" : {
          "login" : "leo-da",
          "name" : "Leonid Shlyapnikov",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/27688859?u=375a6e2bd1079fec6f7d6d582ac05b5628218384&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a4ac22ba1dbfc5a1f114a75812abec7b87d0eb34",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,23 @@\n+-- Copyright (c) 2019 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+-- SPDX-License-Identifier: Apache-2.0\n+\n+---------------------------------------------------------------------------------------------------\n+-- V34: Add a sequential row_id to participant_events\n+--\n+---------------------------------------------------------------------------------------------------\n+\n+-- 1. add the column\n+alter table participant_events add column row_id bigint auto_increment;"
  }
]