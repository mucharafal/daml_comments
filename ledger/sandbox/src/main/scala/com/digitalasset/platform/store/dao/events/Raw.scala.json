[
  {
    "id" : "4ff5db26-46f1-4dd8-8587-ccb74a488835",
    "prId" : 5917,
    "comments" : [
      {
        "id" : "a83aadf5-36e7-440b-b7a1-a5b850702461",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Comment profusely.",
        "createdAt" : "2020-05-08T17:58:31Z",
        "updatedAt" : "2020-05-08T18:55:14Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "3f9f5fbf-d4ef-4677-98f9-9c944a3c8a1d",
        "parentId" : "a83aadf5-36e7-440b-b7a1-a5b850702461",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Addressed by https://github.com/digital-asset/daml/pull/5917/commits/b924b0df2cdd7cf19f2aa64e3afdcc719f4fc149",
        "createdAt" : "2020-05-08T18:56:20Z",
        "updatedAt" : "2020-05-08T18:56:20Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "b924b0df2cdd7cf19f2aa64e3afdcc719f4fc149",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,263 @@\n+// Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package com.daml.platform.store.dao.events\n+\n+import java.io.InputStream\n+\n+import com.daml.ledger.api.v1.event.{\n+  ArchivedEvent => PbArchivedEvent,\n+  CreatedEvent => PbCreatedEvent,\n+  Event => PbFlatEvent,\n+  ExercisedEvent => PbExercisedEvent\n+}\n+import com.daml.ledger.api.v1.transaction.{TreeEvent => PbTreeEvent}\n+import com.daml.platform.participant.util.LfEngineToApi\n+import com.daml.platform.store.serialization.ValueSerializer\n+\n+sealed trait Raw[+E] {\n+  def applyDeserialization(verbose: Boolean): E\n+}"
  },
  {
    "id" : "ac840717-709a-402c-96a5-d791af251e41",
    "prId" : 5917,
    "comments" : [
      {
        "id" : "0105ec6a-7538-4379-84bc-cbd36fb82ed0",
        "parentId" : null,
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Factor out in its own method and re-use.",
        "createdAt" : "2020-05-08T17:58:56Z",
        "updatedAt" : "2020-05-08T18:55:14Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "df6c6bd3-8f68-47a1-85fa-bd8391312872",
        "parentId" : "0105ec6a-7538-4379-84bc-cbd36fb82ed0",
        "author" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "body" : "Addressed by https://github.com/digital-asset/daml/pull/5917/commits/953ecfd11f5753e1d853d7ae618ce69983502ef9",
        "createdAt" : "2020-05-08T18:56:08Z",
        "updatedAt" : "2020-05-08T18:56:08Z",
        "lastEditedBy" : {
          "login" : "stefanobaghino-da",
          "name" : "Stefano Baghino",
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/43749967?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "b924b0df2cdd7cf19f2aa64e3afdcc719f4fc149",
    "line" : null,
    "diffHunk" : "@@ -0,0 +1,263 @@\n+// Copyright (c) 2020 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package com.daml.platform.store.dao.events\n+\n+import java.io.InputStream\n+\n+import com.daml.ledger.api.v1.event.{\n+  ArchivedEvent => PbArchivedEvent,\n+  CreatedEvent => PbCreatedEvent,\n+  Event => PbFlatEvent,\n+  ExercisedEvent => PbExercisedEvent\n+}\n+import com.daml.ledger.api.v1.transaction.{TreeEvent => PbTreeEvent}\n+import com.daml.platform.participant.util.LfEngineToApi\n+import com.daml.platform.store.serialization.ValueSerializer\n+\n+sealed trait Raw[+E] {\n+  def applyDeserialization(verbose: Boolean): E\n+}\n+\n+object Raw {\n+\n+  private[events] sealed abstract class Created[E] private[Raw] (\n+      raw: PbCreatedEvent,\n+      createArgument: InputStream,\n+      createKeyValue: Option[InputStream],\n+  ) extends Raw[E] {\n+    protected def wrap(event: PbCreatedEvent): E\n+    final override def applyDeserialization(verbose: Boolean): E =\n+      wrap(\n+        raw.copy(\n+          contractKey = createKeyValue.map(\n+            key =>\n+              LfEngineToApi.assertOrRuntimeEx(\n+                failureContext = s\"attempting to deserialize persisted key to value\",\n+                LfEngineToApi\n+                  .lfVersionedValueToApiValue(\n+                    verbose = verbose,\n+                    value = ValueSerializer.deserializeValue(key),\n+                  ),"
  }
]